#!/bin/sh
# --------------------------------------------------------------------------- #
# w3_new : Touch and/or remove files to assure that make updates the          #
#          correct subroutines after the switches in switch have been         #
#          changed.                                                           #
#                                                                             #
# use  : w3_new keyword                                                       #
#                                                                             #
# used by : w3_make                                                           #
#                                                                             #
# keyword :  all     : redo entire compilation.                               #
#            ...     : see make_makefile.prog                                 #
#                                                                             #
# error codes :  1 : no environment file $ww3_env found.                      #
#                                                                             #
# programs used :                                                             #
#                                                                             #
#                                                      Hendrik L. Tolman      #
#                                                      May 2009               #
#                                                                             #
#    Copyright 2009 National Weather Service (NWS),                           #
#       National Oceanic and Atmospheric Administration.  All rights          #
#       reserved.  WAVEWATCH III is a trademark of the NWS.                   #
#       No unauthorized use without permission.                               #
#                                                                             #
# --------------------------------------------------------------------------- #
# 1. Preparations                                                             #
# --------------------------------------------------------------------------- #
# 1.a Check and process input

  if test "$#" -lt '1'
  then
    keys='all'
  else
    keys="$*"
  fi

# 1.b Internal variables - - - - - - - - - - - - - - - - - - - - - - - - - - - 

  ww3_env="${HOME}/.wwatch3.env"                           # setup file
  if [ ${WWATCH3_ENV} ]; then ww3_env="${WWATCH3_ENV}"; fi # alternate setup file

# 1.c Read data from the environment file  - - - - - - - - - - - - - - - - - -

  if [ ${WWATCH3_DIR} ]
  then
    main_dir=${WWATCH3_DIR}
  elif test -f $ww3_env
  then
    set `grep WWATCH3_DIR $ww3_env` ; shift
    main_dir="$*"
  else
    echo "*** Set-up file $ww3_env not found ***"
    exit 1
  fi

# --------------------------------------------------------------------------- #
# 2. Process keywords.                                                        #
# --------------------------------------------------------------------------- #

  for key in $keys
  do
    case $key in
     'all'    ) cd $main_dir/obj ; rm -f *.o 
                cd $main_dir/mod ; rm -f *.mod
                cd $main_dir/exe ; rm -f ww3_* gx_* ;;
     'mach'   ) cd $main_dir/ftn ; touch w3servmd.ftn
                                   touch wmmdatmd.ftn
                                   touch wminitmd.ftn
                                   touch wmfinlmd.ftn
                                   touch ww3_shel.ftn ;; 
     'nco'    ) cd $main_dir/ftn ; touch ww3_prep.ftn
                                   touch ww3_shel.ftn
                                   touch ww3_outp.ftn
                                   touch ww3_grib.ftn ;; 
     'grib'   ) cd $main_dir/ftn ; touch ww3_grib.ftn ;; 
     'shared' ) cd $main_dir/obj ; rm -f *.o 
                cd $main_dir/mod ; rm -f *.mod ;;
     'mpp'    ) cd $main_dir/obj ; rm -f *.o 
                cd $main_dir/mod ; rm -f *.mod ;;
     'thr0'   ) cd $main_dir/ftn ; touch w3wavemd.ftn ;;
     'thr1'   ) cd $main_dir/ftn ; touch w3updtmd.ftn
                                   touch w3iogomd.ftn ;;
     'c90'    ) cd $main_dir/ftn ; touch w3iogomd.ftn
                                   touch w3pro1md.ftn
                                   touch w3pro2md.ftn
                                   touch w3pro3md.ftn
                                   touch w3uqckmd.ftn ;;
     'nec'    ) cd $main_dir/ftn ; touch w3initmd.ftn
                                   touch w3iogomd.ftn
                                   touch w3pro1md.ftn
                                   touch w3pro2md.ftn
                                   touch w3pro3md.ftn
                                   touch w3uqckmd.ftn ;;
     'lrecl'  ) cd $main_dir/ftn ; touch w3iorsmd.ftn ;;
     'grid'   ) cd $main_dir/ftn ; touch w3gdatmd.ftn
                                   touch w3updtmd.ftn
                                   touch w3iopomd.ftn
                                   touch w3iotrmd.ftn
                                   touch w3iosfmd.ftn
                                   touch w3bullmd.ftn
                                   touch w3pro2md.ftn
                                   touch w3initmd.ftn
                                   touch w3wavemd.ftn
                                   touch wmupdtmd.ftn
                                   touch wmgridmd.ftn
                                   touch wminitmd.ftn
                                   touch wmiopomd.ftn
                                   touch ww3_grid.ftn
                                   touch ww3_strt.ftn
                                   touch ww3_prep.ftn
                                   touch ww3_shel.ftn
                                   touch ww3_outp.ftn
                                   touch ww3_outf.ftn
                                   touch ww3_trck.ftn
                                   touch ww3_grib.ftn
                                   touch gx_outp.ftn
                                   touch gx_outf.ftn ;;
     'prop'   ) cd $main_dir/ftn ; touch w3gdatmd.ftn
                                   touch w3adatmd.ftn
                                   touch w3iogrmd.ftn
                                   touch w3wavemd.ftn
                                   touch wmgridmd.ftn
                                   touch ww3_grid.ftn ;; 
     'stress' ) cd $main_dir/ftn ; touch w3srcemd.ftn
                                   touch w3gdatmd.ftn
                                   touch w3iogrmd.ftn
                                   touch ww3_outp.ftn
                                   touch ww3_grid.ftn
                                   touch gx_outp.ftn ;;
     's_ln'   ) cd $main_dir/ftn ; touch w3gdatmd.ftn
                                   touch w3srcemd.ftn
                                   touch w3iogrmd.ftn
                                   touch w3iorsmd.ftn
                                   touch ww3_grid.ftn
                                   touch ww3_outp.ftn
                                   touch gx_outp.ftn ;;
     'source' ) cd $main_dir/ftn ; touch w3gdatmd.ftn
                                   touch w3srcemd.ftn
                                   touch w3updtmd.ftn
                                   touch w3iogrmd.ftn
                                   touch w3iogomd.ftn
                                   touch ww3_grid.ftn
                                   touch ww3_outp.ftn
                                   touch gx_outp.ftn ;;
     'stab'   ) cd $main_dir/ftn ; touch w3updtmd.ftn
                                   touch w3src3md.ftn
                                   touch ww3_grid.ftn
                                   touch ww3_outp.ftn
                                   touch gx_outp.ftn ;;
     's_nl'   ) cd $main_dir/ftn ; touch w3gdatmd.ftn
                                   touch w3adatmd.ftn
                                   touch w3srcemd.ftn
                                   touch w3iogrmd.ftn
                                   touch wminitmd.ftn
                                   touch ww3_grid.ftn
                                   touch ww3_strt.ftn
                                   touch ww3_prep.ftn
                                   touch ww3_outp.ftn
                                   touch gx_outp.ftn ;;
     's_bot'  ) cd $main_dir/ftn ; touch w3gdatmd.ftn
                                   touch w3srcemd.ftn
                                   touch w3iogrmd.ftn
                                   touch ww3_grid.ftn
                                   touch ww3_outp.ftn
                                   touch gx_outp.ftn ;;
     's_db'   ) cd $main_dir/ftn ; touch w3gdatmd.ftn
                                   touch w3srcemd.ftn
                                   touch w3iogrmd.ftn
                                   touch ww3_grid.ftn
                                   touch ww3_outp.ftn
                                   touch gx_outp.ftn ;;
     's_tr'   ) cd $main_dir/ftn ; touch w3gdatmd.ftn
                                   touch w3srcemd.ftn
                                   touch w3iogrmd.ftn
                                   touch ww3_grid.ftn
                                   touch ww3_outp.ftn
                                   touch gx_outp.ftn ;;
     's_bs'   ) cd $main_dir/ftn ; touch w3gdatmd.ftn
                                   touch w3srcemd.ftn
                                   touch w3iogrmd.ftn
                                   touch w3sbsxmd.ftn
                                   touch ww3_grid.ftn
                                   touch ww3_outp.ftn
                                   touch gx_outp.ftn ;;
     's_xx'   ) cd $main_dir/ftn ; touch w3gdatmd.ftn
                                   touch w3srcemd.ftn
                                   touch w3iogrmd.ftn
                                   touch ww3_grid.ftn
                                   touch ww3_outp.ftn
                                   touch gx_outp.ftn ;;
     'wind'   ) cd $main_dir/ftn ; touch w3updtmd.ftn
                                   touch ww3_prep.ftn ;; 
     'windx'  ) cd $main_dir/ftn ; touch wmupdtmd.ftn ;;
     'rwind'  ) cd $main_dir/ftn ; touch w3updtmd.ftn ;;
     'curr'   ) cd $main_dir/ftn ; touch w3updtmd.ftn
                                   touch ww3_prep.ftn ;; 
     'currx'  ) cd $main_dir/ftn ; touch wmupdtmd.ftn ;;
     'tdyn'   ) cd $main_dir/ftn ; touch w3pro2md.ftn ;;
     'dss0'   ) cd $main_dir/ftn ; touch w3pro2md.ftn ;;
     'pdif'   ) cd $main_dir/ftn ; touch w3pro2md.ftn ;;
     'miche'  ) cd $main_dir/ftn ; touch w3gdatmd.ftn
                                   touch w3srcemd.ftn
                                   touch ww3_grid.ftn ;;
     'mgwind' ) cd $main_dir/ftn ; touch w3updtmd.ftn
                                   touch wminitmd.ftn
                                   touch ww3_shel.ftn ;; 
     'mgprop' ) cd $main_dir/ftn ; touch w3pro1md.ftn
                                   touch w3pro2md.ftn
                                   touch w3pro3md.ftn
                                   touch wminitmd.ftn
                                   touch ww3_shel.ftn ;; 
     'mggse'  ) cd $main_dir/ftn ; touch w3pro3md.ftn
                                   touch ww3_shel.ftn ;;
     'nnt'    ) cd $main_dir/ftn ; touch w3srcemd.ftn ;;
     'mprf'   ) cd $main_dir/ftn ; touch wmmdatmd.ftn
                                   touch wminitmd.ftn
                                   touch wmwavemd.ftn
                                   touch wmfinlmd.ftn ;;
     'mcp'    ) cd $main_dir/ftn ; touch wmwavemd.ftn
                                   touch ww3_shel.ftn ;;
     'netcdf' ) cd $main_dir/ftn ; touch ww3_ounf.ftn
                                   touch ww3_ounp.ftn
                                   touch ww3_prnc.ftn ;;
      'reflection' )  cd $main_dir/ftn ; touch w3ref1md.ftn ;;
       *      ) echo "w3_new: keyword [$key] not recognized" ;;
    esac
  done
  
# End of w3_new ------------------------------------------------------------- #
