\section{~Governing equations} \label{chapt:eq}
\newcounters
\vssub
\subsection{~Introduction}
\vssub

Waves or spectral wave components in water with limited depth and non-zero
mean currents are generally described using several phase and amplitude
parameters. Phase parameters are the wavenumber vector {\bk}, the wavenumber
$k$, the direction $\theta$ and several frequencies. If effects of mean
currents on waves are to be considered, a distinction is made between the
relative or intrinsic (radian) frequency $\sigma$ $(= 2 \pi f_r)$, which is
observed in a frame of reference moving with the mean current, and the
absolute (radian) frequency $\omega$ $(= 2 \pi f_a)$, which is observed in a
fixed frame of reference.  The direction $\theta$ is by definition
perpendicular to the crest of the wave (or spectral component), and equals the
direction of {\bk}. Generally, scales of variation of depths and currents are
assumed to be much larger than those of an individual wave. The quasi-uniform
(linear) wave theory then can be applied locally, giving the following
dispersion relation and Doppler type equation to interrelate the phase
parameters

%-----------------------------------%
% dispersion and Doppler equations  %
%-----------------------------------%
% eq:disp
% eq:doppler

\begin{equation}
\sigma ^2 = g k \tanh kd \: ,
\label{eq:disp}
\end{equation}
\begin{equation}
\omega = \sigma + {\bk} \cdot {\bf U} \: ,
\label{eq:doppler}
\end{equation}

\noindent
where $d$ is the mean water depth and {\bf U} is the (depth- and time-
averaged) current velocity. The assumption of slowly varying depths and
currents implies a large-scale bathymetry, for which wave diffraction can
generally be ignored. The usual definition of {\bk} and $\omega$ from the
phase function of a wave or wave component implies that the number of wave
crests is conserved \citep[see, e.g.,][]{bk:Phi77,bk:Mei83}

%-----------------------------%
% conservation of wave crests %
%-----------------------------%
% eq:wnconv

\begin{equation}
\frac{\partial {\bk}}{\partial t} + \nabla \omega = 0 \: .
\label{eq:wnconv}
\end{equation}

\noindent
From Eqs.~(\ref{eq:disp}) through (\ref{eq:wnconv}) the rates of change of the
phase parameters can be calculated \citep[e.g.,][equations not reproduced
here]{rep:Chr82,bk:Mei83,tol:JPO90}.

For monochromatic waves, the amplitude is described as the amplitude, the wave
height, or the wave energy. For irregular wind waves, the (random) variance of
the sea surface is described using variance density spectra (in the wave
modeling community usually denoted as energy spectra). The variance spectrum
$F$ is a function of all independent phase parameters, i.e.,
$F({\bk},\sigma,\omega)$, and furthermore varies in space and time, e.g.,
$F({\bk},\sigma,\omega ;\bx,t)$. However, it is usually assumed that the
individual spectral components satisfy the linear wave theory (locally), so
that Eqs.~(\ref{eq:disp}) and (\ref{eq:doppler}) interrelate {\bk}, $\sigma$
and $\omega$. Consequently only two independent phase parameters exist, and
the local and instantaneous spectrum becomes two-dimensional. Within \ws\ the
basic spectrum is the wavenumber-direction spectrum $F(k,\theta)$, which has
been selected because of its invariance characteristics with respect to
physics of wave growth and decay for variable water depths. The output of \ws,
however, consists of the more traditional frequency-direction spectrum
$F(f_r,\theta)$. The different spectra can be calculated from $F(k,\theta)$
using straightforward Jacobian transformations

%--------------------------------------------%
% Jacobian transformation and group velocity %
%--------------------------------------------%
% eq:jac_fr
% eq:jac_fa
% eq:cg

\begin{equation}
F(f_r,\theta) = \frac{\partial k}{\partial f_r} F(k,\theta) =
\frac{2\pi}{c_g} F(k,\theta) \: ,
\label{eq:jac_fr}
\end{equation}
\begin{equation}
F(f_a,\theta) = \frac{\partial k}{\partial f_a} F(k,\theta) =
\frac{2\pi}{c_g}
\left ( 1 + \frac{{\bk}\cdot{\bf U}}{k c_g}\right )^{-1}
F(k,\theta) \: ,
\label{eq:jac_fa}
\end{equation}
\begin{equation}
c_g = \frac{\partial \sigma}{\partial k} = n \frac{\sigma}{k}
\; , \;
n = \frac{1}{2} + \frac{kd}{\sinh 2kd} \; ,
\label{eq:cg}
\end{equation}

\noindent
where $c_g$ is the so-called group velocity.  From any of these spectra
one-dimensional spectra can be generated by integration over directions,
whereas integration over the entire spectrum by definition gives the total
variance $E$ (in the wave modeling community usually denoted as the wave
energy).

In cases without currents, the variance (energy) of a wave package is a
conserved quantity. In cases with currents the energy or variance of a
spectral component is no longer conserved, due to the work done by current on
the mean momentum transfer of waves \citep{art:LHS61,art:LHS62}. In a general
sense, however, wave action $A \equiv E/\sigma$ is conserved
\citep[e.g.,][]{art:Whi65,art:BG68}. This makes the wave action density
spectrum $N(k,\theta) \equiv F(k,\theta)/\sigma$ the spectrum of choice within
the model. Wave propagation then is described by

%--------------------------------------%
% Most general action balance equation %
%--------------------------------------%
% eq:balance0

\begin{equation}
\frac{D N}{D t} = \frac{S}{\sigma} \: ,
\label{eq:balance0}
\end{equation}

\noindent
where $D/Dt$ represents the total derivative (moving with a wave component)
and $S$ represents the net effect of sources and sinks for the spectrum
$F$. Because the left side of Eq.~(\ref{eq:balance0}) generally considers
linear propagation without scattering, effects of nonlinear wave propagation (i.e., wave-wave
interactions) and partial wave reflections arise in $S$. Propagation and source terms will be discussed
separately in the following sections.

% -------------------------------------------------------------
\vssub
\subsection{~Propagation}
\vssub

In a numerical model, a Eulerian form of the balance equation
(\ref{eq:balance0}) is needed. This balance equation can either be written in
the form of a transport equation (with velocities outside the derivatives), or
in a conservation form (with velocities inside the derivatives). The former
form is valid for the vector wavenumber spectrum $N(\bk;\bx,t)$ only, whereas
valid equations of the latter form can be derived for arbitrary spectral
formulations, as long as the corresponding Jacobian transformation as
described above is well behaved \citep[e.g.,][]{tol:GAOS98b}. Furthermore, the
conservation equation conserves total wave energy/action, unlike the transport
equation. This is an important feature of an equation when applied in a
numerical model. The balance equation for the spectrum $N(k,\theta;\bx,t)$ as
used in \ws\ is given as (for convenience of notation, the spectrum is
henceforth denoted simply as $N$)

%----------------------------------%
% Plain-grid propagation equations %
%----------------------------------%
% eq:bal_plane
% eq:x_dot
% eq:k_dot
% eq:theta_dot

\begin{equation}
\frac{\partial N}{\partial t} + \nabla_x \cdot {\bf\dot{x}}N +
\frac{\partial}{\partial k} \dot{k}N +
\frac{\partial}{\partial \theta} \dot{\theta}N =
\frac{S}{\sigma} \: , \label{eq:bal_plane}
\end{equation}
\begin{equation}
{\bf \dot{x}} = {\bf c}_g + {\bf U} \: , \label{eq:x_dot}
\end{equation}
\begin{equation}
\dot{k} = - \frac{\partial \sigma}{\partial d}
\frac{\partial d}{\partial s} - {\bk} \cdot
\frac{\partial {\bf U}}{\partial s} \: , \label{eq:k_dot}
\end{equation}
\begin{equation}
\dot{\theta} = - \frac{1}{k} \left [
\frac{\partial \sigma}{\partial d} \frac{\partial d}{\partial m}
- {\bk} \cdot \frac{\partial {\bf U}}{\partial m}
\right ] \: , \label{eq:theta_dot}
\end{equation}

\noindent
where ${\bf c}_g$ is given by $c_g$ and $\theta$, $s$ is a coordinate in the
direction $\theta$ and $m$ is a coordinate perpendicular to $s$.
Equation~(\ref{eq:bal_plane}) is valid for a Cartesian grid. For large-scale
applications, this equation is usually transferred to a spherical grid,
defined by longitude $\lambda$ and latitude $\phi$, but maintaining the
definition of the local variance \citep[i.e., per unit surface, as
in][]{art:WAM88}

%---------------------------------%
% Spherical propagation equations %
%---------------------------------%
% eq:bal_sphere
% eq:phi_dot
% eq:lambda_dot
% eq:theta_g_dot

\begin{equation}
\frac{\partial N}{\partial t} +
\frac{1}{\cos \phi} \frac{\partial}{\partial \phi} \dot{\phi}
    N \cos \theta +
\frac{\partial}{\partial \lambda} \dot{\lambda}N +
\frac{\partial}{\partial k} \dot{k} N +
\frac{\partial}{\partial \theta} \dot{\theta}_g N
= \frac{S}{\sigma} \: ,\label{eq:bal_sphere}
\end{equation}
\begin{equation}
\dot{\phi} = \frac{c_g \cos \theta + U_\phi}{R}
\: , \label{eq:phi_dot}
\end{equation}
\begin{equation}
\dot{\lambda} =  \frac{c_g \sin \theta + U_\lambda}{R \cos \phi}
\: , \label{eq:lambda_dot}
\end{equation}
\begin{equation}
\dot{\theta}_g = \dot{\theta} -
\frac{c_g \tan \phi \cos \theta}{R}
\: , \label{eq:theta_g_dot}
\end{equation}

\noindent
where $R$ is the radius of the earth and $U_\phi$ and $U_\lambda$ are current
components. Equation~(\ref{eq:theta_g_dot}) includes a correction term for
propagation along great circles, using a Cartesian definition of $\theta$
where $\theta = 0$ corresponds to waves traveling from west to east. \ws\ can
be run on either a Cartesian of spherical grid. Note that unresolved obstacles
such as islands can be included in the equations. In \ws\ this is done at the
level of the numerical scheme, as is discussed in section~\ref{sec_obst}.


% -------------------------------------------------------------
\vssub
\subsection{~Source terms}
\vsssub
\subsubsection{~General concepts}
\vsssub

In deep water, the net source term $S$ is generally considered to consist of
three parts, a wind-wave interaction term $S_{in}$, a nonlinear wave-wave
interactions term $S_{nl}$ and a dissipation (`whitecapping') term $S_{ds}$.
The input term $S_{in}$ is dominated by the exponential growth term, and this
source term generally describes this dominant process only. For model
initialization, and to provide more realistic initial wave growth, and linear
input term $S_{ln}$ can also be considered in \ws.

In shallow water additional processes have to be considered, most notably
wave-bottom interactions $S_{bot}$ \cite[e.g.,][]{pro:Sea78}. In extremely
shallow water, depth-induced breaking ($S_{db}$) and triad wave-wave
interactions ($S_{tr}$) become important. Also available in \ws\ are source
terms for scattering of waves by bottom features ($S_{sc}$), reflection off shorelines or floating objects such as icebergs ($S_{ref}$) and a general
purpose slot for additional, user defined source terms ($S_{xx}$

This defines the general source terms used in \ws\ as

%---------------------------------%
% General source term composition %
%---------------------------------%
% eq:general_st

\begin{equation}
S = S_{ln} + S_{in} + S_{nl} + S_{ds} + S_{bot} + S_{db} + S_{tr} + S_{sc} + S_{ref} +
    S_{xx}\: .
\label{eq:general_st}
\end{equation}

\noindent
Other source terms are easily added. These source terms are defined for the
{\em energy} spectra. In the model, however, most source terms are directly
calculated for the action spectrum. The latter source terms are denoted as
$\cS \equiv S/\sigma$.

The treatment of the nonlinear interactions defines a third-generation wave
model. Therefore, the options for the calculation of $S_{nl}$ will be
discussed first in sections \ref{sec_dia} and \ref{sec_xnl}. $S_{in}$ and
$S_{ds}$ represent separate processes, but should be considered as
interrelated, because the balance of these two source terms governs the
integral growth characteristics of the wave model. Two combinations of these
basic source terms are available, those of \wam\ cycles 1 through 3
(\para\ref{sec:wam}) and the parameterizations of \cite{tol:JPO96}
(\para\ref{sec:t&c}) and those of \wam\ cycle 4\footnote{~including recent
updates.} (\para\ref{sec:wam4}). Linear input, shallow water source terms or
source terms describing special physical processes are considered to be
"additional" source terms. Available options are described in
Sections~\ref{sec:c&mr} through \ref{sec:sxx}.

\vspace{\baselineskip} \noindent
A third-generation wave model effectively integrates the spectrum only up to a
cut-off frequency $f_{hf}$ (or wavenumber $k_{hf}$). Above this frequency a
parametric tail is applied \citep[e.g.,][]{art:WAM88}

%--------------------------------------%
% General tail parameterization E(f,t) %
%--------------------------------------%
% eq:tail_E_f

\begin{equation}
F(f_r,\theta) = F(f_{r,hf},\theta) \left ( \frac{f_r}{f_{r,hf}}
\right ) ^{-m} \label{eq:tail_E_f}
\end{equation}

\noindent
which is easily transformed to any other spectrum using the Jacobian
transformations as discussed above. For instance, for the present action
spectrum, the parametric tail can be expressed as (assuming deep water for the
wave components in the tail)

%--------------------------------------%
% General tail parameterization N(k,t) %
%--------------------------------------%
% eq:tail_N_k

\begin{equation}
N(k,\theta) = N(k_{hf},\theta) \left ( \frac{f_r}{f_{r,hf}}
\right ) ^{-m-2} \label{eq:tail_N_k}
\end{equation}

\noindent
The actual values of $m$ and the expressions for $f_{r,hf}$ depend on the
source term parameterization used, and will be given below.

\vspace{\baselineskip} \noindent
Before actual source term parameterizations are described, the definition of
the wind requires some attention. In cases with currents, one can either
consider the wind to be defined in a fixed frame of reference, or in a frame
of reference moving with the current. Both definitions are available in \ws,
and can be selected during compilation. The output of the program, however,
will always be the wind speed which is not in any way corrected for the
current.


% -------------------------------------------------------------
\vsssub
\subsubsection{~Nonlinear interactions (\dia)} \label{sec_dia}
\vsssub

Nonlinear wave-wave interactions can be modeled using the discrete interaction
approximation \citep[\dia,][]{art:Hea85b}. This parameterization was
originally developed for the spectrum $F(f_r ,\theta)$. To assure the
conservative nature of $S_{nl}$ for this spectrum (which can be considered as
the "final product" of the model), this source term is calculated for
$F(f_r,\theta)$ instead of $N(k,\theta)$, using the conversion
(\ref{eq:jac_fr}).

Resonant nonlinear interactions occur between four wave components
(quadruplets) with wavenumber vector $\bk_1$ through $\bk_4$. In the \dia, it
is assumed that $\bk_1 = \bk_2$. Resonance conditions then require that

%--------------------------%
% Resonance conditions DIA %
%--------------------------%
% eq:resonance

\begin{equation} \left .
\begin{array}{ccc}
  \bk_1 + \bk_2 & = & \bk_3 + \bk_4          \\
  \sigma_2  & = & \sigma_1                   \\
  \sigma_3  & = & (1+\lambda_{nl})\sigma_1   \\
  \sigma_4  & = & (1-\lambda_{nl})\sigma_1
\end{array} \:\:\: \right \rbrace \:\:\: , \label{eq:resonance}
\end{equation}

\noindent
where $\lambda_{nl}$ is a constant. For these quadruplets, the contribution
$\delta S_{nl}$ to the interaction for each discrete $(f_r,\theta)$
combination of the spectrum corresponding to $\bk_1$ is calculated as

%----------------------------%
% Nonlinear interactions DIA %
%----------------------------%
% eq:snl_dia

\begin{eqnarray}
\left ( \begin{array}{c}
  \delta S_{nl,1} \\ \delta S_{nl,3} \\ \delta S_{nl,4}
\end{array} \right ) & = & D
\left ( \begin{array}{r} -2 \\ 1 \\ 1 \end{array} \right )
C g^{-4} f_{r,1}^{11} \times \nonumber \\
& & \left [ F_1^2
\left ( \frac{F_3}{(1+\lambda_{nl})^4} +
        \frac{F_4}{(1-\lambda_{nl})^4} \right ) -
\frac{2 F_1 F_3 F_4}{(1-\lambda_{nl}^2)^4}
\right ] \: , \label{eq:snl_dia}
\end{eqnarray}

\noindent
where $F_1 = F(f_{r,1} ,\theta_1 )$ etc. and $\delta S_{nl,1} = \delta
S_{nl}(f_{r,1} ,\theta_1 )$ etc., $C$ is a proportionality constant. The
nonlinear interactions are calculated by considering a limited number of
combinations $(\lambda_{nl},C)$. In practice, only one combination is
used. Default values for different source term packages are presented in
Table~\ref{tab:snl_par}.


% tab:snl_par

\begin{table} \begin{center}
 \begin{tabular}{|l|c|c|} \hline \hline
                    & $\lambda_{nl}$ &     $C$      \\ \hline
\wam-3              &      0.25      & $2.78 \; 10^7$  \\ \hline
ST4 (Ardhuin et al.)&      0.25      & $2.50 \; 10^7$  \\ \hline
Tolman and Chalikov &      0.25      & $1.00 \; 10^7$  \\ \hline \hline
\end{tabular} \end{center}
\caption{Default constants in \dia\ for input-dissipation packages.}
\label{tab:snl_par} \botline \end{table}

This source term is developed for deep water, using the appropriate dispersion
relation in the resonance conditions. For shallow water the expression is
scaled by the factor $D$ (still using the deep-water dispersion relation,
however)

%------------------%
% Depth factor DIA %
%------------------%
% eq:snl_shal

\begin{equation}
D = 1 + \frac{c_1}{\bar{k}d} \left [ 1 - c_2 \bar{k} d
\right ] e^{-c_3 \bar{k} d} \: . \label{eq:snl_shal}
\end{equation}

\noindent
Recommended (default) values for the constants are \citep{art:Hea85a}
$c_1=5.5$, $c_2=5/6$ and $c_3=1.25$. The overbar notation denotes
straightforward averaging over the spectrum. For an arbitrary parameter z the
spectral average is given as

%--------------------------%
% Definition spectral mean %
%--------------------------%
% eq:zbar
% eq:etot

\begin{equation}
\bar{z} = E^{-1} \int_{0}^{2\pi} \int_{0}^{\infty}
z F(f_r,\theta) \; d f_r \; d\theta \: , \label{eq:zbar}
\end{equation}
\begin{equation}
E = \int_{0}^{2\pi} \int_{0}^{\infty}
F(f_r,\theta) \; d f_r \; d\theta \: , \label{eq:etot}
\end{equation}

\noindent
For numerical reasons, however, the mean relative depth is estimated as

%------------%
% kd for DIA %
%------------%
% eq:kd_num
% eq:k_hat

\begin{equation}
\bar{k} d = 0.75 \hat{k} d \: , \label{eq:kd_num}
\end{equation}

\noindent
where $\hat{k}$ is defined as

\begin{equation}
\hat{k} = \left ( \overline{1/\sqrt{}k} \right )^{-2} \: .
\label{eq:k_hat}
\end{equation}

\noindent
The shallow water correction of Eq.~(\ref{eq:snl_shal}) is valid for
intermediate depths only. For this reason the mean relative depth $\bar{k}d$
is not allowed to become smaller than 0.5 (as in \wam). All above constants
can be reset by the user in the input files of the model (see
chapter~\ref{chapt:run}).


% -------------------------------------------------------------
\vsssub
\subsubsection{~Nonlinear interactions (\xnl) \hfill {\rm (G. Ph. van Vledder)}} \label{sec_xnl}
\vsssub

The second method for calculating the nonlinear interactions in \ws\ is the
so-called Webb-Resio-Tracy method (\xnl), which is based on the original
six-dimensional Boltzmann integral formulation of
\cite{art:Has62,art:Has63a,art:Has63b}, and additional considerations by
\cite{art:Web78}, \cite{rep:TR82} and \cite{art:RP91}.

The Boltzmann integral describes the rate of change of action density of a
particular wavenumber due to resonant interactions between pairs of four
wavenumbers. To interact these wavenumbers must satisfy the following
resonance conditions

%--------------------------%
% Resonance conditions WRT %
%--------------------------%
% eq:resonance_2

\begin{equation} \left .
\begin{array}{ccc}
  \bk_1 + \bk_2 & = & \bk_3 + \bk_4          \\
  \sigma_1 + \sigma_2  & = & \sigma_3 + \sigma_4
\end{array} \:\:\: \right \rbrace \:\:\: , \label{eq:resonance_2}
\end{equation}

\noindent
which is a more general version of the resonance conditions
(\ref{eq:resonance}). The rate of change of action density $N_1 $ at
wave number $\bk_1$ due to all quadruplet interactions involving
$\bk_1$ is given by

\begin{eqnarray}
\frac{{\p N_1 }}{{\p t}} & = & \int\!\!\int\!\!\int G\left( \bk_1
,\bk_2 ,\bk_3 ,\bk_4 \right ) \: \delta \left( \bk_1  + \bk_2  - \bk_3
- \bk_4 \right)
\: \delta \left( {\sigma _1  + \sigma _2  - \sigma _3  - \sigma _4 }
\right) \nonumber \\  & &
\hspace{7mm}\times \:\:\: \left[ {N_1 N_3 \left( {N_4  - N_2 } \right)
+ N_2 N_4 \left(
{N_3  - N_1 } \right)} \right] \: d\bk_2 \: d\bk_3 \: d\bk_4 \:\:\: ,
\end{eqnarray}

\noindent
where the action density $N$ is defined in terms of the wavenumber
vector $\bk$, $N = N(\bk)$. The term $G$ is a complicated coupling
coefficients for which expressions have been given by \cite{art:HH80}.
In the \xnl\ method a number of transformations are
made to remove the delta functions. A key element in the \xnl\ method
is to consider the integration space for each ($\bk_1 ,\bk_3 $)
combination \citep[see][]{art:RP91}

\begin{equation}
{{\partial N_1 } \over {\partial t}} = 2\int T\left( {\bk_1 ,\bk_3 }
\right) \: d\bk_3  \:\:\: ,
\end{equation}

\noindent
in which the function $T$ is given by

\begin{eqnarray}
T \left( \bk_1 ,\bk_3 \right) & = & \int\!\!\int
G\left( \bk_1 ,\bk_2, \bk_3 ,\bk_4 \right) \: \delta \left( \bk_1  +
\bk_2  - \bk_3  - \bk_4 \right) \nonumber \\
& \times & \delta \left( {\sigma _1  + \sigma _2  - \sigma _3  -
\sigma _4 }
\right) \: \theta \left ( \bk_1 , \bk_3 , \bk_4 \right )
\nonumber \\
& \times & \left [ N_1 N_3 \left ( N_4 - N_2 \right ) + N_2 N_4 \left
(
N_3  - N_1 \right ) \right ] \: d\bk_2 \: d\bk_4 \:\:\: ,
\label{eq:WRT_T}
\end{eqnarray}

\noindent
in which

\begin{equation}
\theta \left( {\bk_1 ,\bk_3 ,\bk_4 } \right) = \left\{ {\begin{array}{*{20}c}
   1 & {\rm{when}} & {\left| {\bk_1  - \bk_3 } \right| \leq \left| {\bk_1  - \bk_4 } \right|}  \\
   0 & {\rm{when}} & {\left| {\bk_1  - \bk_3 } \right| > \left| {\bk_1  - \bk_4 } \right|}  \\
 \end{array} } \right.
\end{equation}

The delta functions in Eq. (\ref{eq:WRT_T}) determine a region in wavenumber
space along which the integration should be carried out.  The function
$\theta$ determines a section of the integral which is not defined due to the
assumption that $\bk_1$ is closer to $\bk_3$ than $\bk_2$. The crux of the
Webb method consists of using a local coordinate system along a so-named
locus, that is, the path in $\bk$ space given by the resonance conditions for
a given combination of $\bk_1$ and $\bk_3$. To that end the $(k_{x},k_{y})$
coordinate system is replaced by a $(s,n)$ coordinate system, where $s$ ($n$)
is the tangential (normal) direction along the locus. After some
transformations the transfer integral can then be written as a closed line
integral along the closed locus

\begin{eqnarray}
T \left( \bk_1 ,\bk_3 \right) & = & \oint G \:
\left | \frac{\p W(s,n)}{\p n}\right | ^{-1}
\: \theta ( \bk_1 , \bk_3 , \bk_4 ) \nonumber \\
& \times & \left [ N_1 N_3 \left ( N_4 - N_2 \right ) + N_2 N_4 \left
(
N_3  - N_1 \right ) \right ] \: d s  \:\:\: , \label{eq:WRT_T2}
\end{eqnarray}

\noindent
In which $G$ is the coupling coefficient and $\left| {\partial W/\partial n}
\right|$ is the gradient term of a function representing the resonance
conditions \citep[see][]{pro:vVl00}. Numerically, the Boltzmann integral is
computed as the finite sum of many line integrals $T$ for all discrete
combinations of $\bk_1$ and $\bk_3$. The line integral (\ref{eq:WRT_T2}) is
solved by dividing the locus in typically 30 pieces, such that the discretized
version is given as:

\begin{equation}
T\left( {\bk_1 ,\bk_3 } \right) \approx \sum_{i=1}^{n_s } G(s_i)
W(s_i) P(s_i) \: \Delta s_i \:\:\: ,
\end{equation}

\noindent
in which $P(s_i)$ is the product term for a given point on the locus,
$n_s$ is the number of segments, and $s_i$ is the discrete coordinate
along the locus. Finally, the rate of change for a given wavenumber
$\bk_1 $ is given by

\begin{equation}
\frac{\p N(\bk_1)}{\p t} \approx \sum_{i_{k3}  = 1}^{n_k }
{\sum_{i_{\theta 3}  = 1}^{n_\theta  } k_3 T(\bk_1,\bk_3) \: \Delta
k_{i_{k3}} \: \Delta \theta_{i_{\theta 3} } } \label{eq:WRT_numT}
\end{equation}

\noindent
where $n_k$ and $n_\theta$ are the discrete number of wavenumbers and
directions in the calculational grid, respectively. Note that although the
spectrum is defined in terms of the vector wavenumber $\bk$, the calculational
grid in a wave model is more conveniently defined in terms of the absolute
wavenumber and wave direction ($k,\theta$) to assure directional isotropy of
the calculations. Taking all wave numbers $\bk_1 $ into account produces the
complete source term due to nonlinear quadruplet wave-wave
interactions. Details of the efficient computation of a locus for a given
combination of the wave numbers $\bk_1 $ and $\bk_3 $ can be found in
\cite{pro:vVl00,rep:vVl02a,rep:vVl02b}.

It should be noted that these exact interaction calculations are extremely
expensive, typically requiring $10^3$ to $10^4$ times more computational
effort than the \dia. Presently, these calculations can therefore only be made
for highly idealized test cases involving a limited spatial grid.

The nonlinear interactions according to the \xnl\ method have been implemented
in \ws\ using the portable subroutines developed by \cite{rep:vVl02b}.  In
this implementation, the computational grid of the \xnl\ method is taken
identical to the discrete spectral grid of \ws.  In addition, the \xnl\
routines inherit the power of the parametric spectral tail as in the
\dia. Choosing a higher resolution than the computational grid of \ws\ for
computing the nonlinear interactions is possible in theory, but this does not
improve the results and is therefore not implemented.

Because nonlinear quadruplet wave-wave interactions at high frequencies are
important, it is recommended to choose the maximum frequency of the wave model
about five times the peak frequency of the spectra that are expected to occur
in a wave model run. Note that this is important as the spectral grid
determines the range of integration in Eq.~(\ref{eq:WRT_numT}). The
recommended number of frequencies is about 40, with a frequency increment
factor 1.07. The recommended directional resolution for computing the
nonlinear interactions is about $10^\circ$. For specific purposes other
resolutions may be used, and some testing with other resolutions may be
needed.

An important feature of most algorithms for the evaluation of the Boltzmann
integral is that the integration space can be pre-computed.  This is also the
case for the subroutine version of the \xnl\ method used in \ws. In the
initialization phase of the wave model the integration space, consisting of
the discretized paths of all loci, together with the interaction coefficients
and gradient terms, are computed and stored in a binary data file. For each
water depth such a data file is generated and stored in the current
directory. The names of these data files consist of a keyword, "quad",
followed by the keyword "{\it{xxxx}}", with {\it xxxx} the water depth in
meters, or 9999 for deep water.  The extension of the binary data file is
"bqf" (of Binary Quadruplet File). If a BQF file exists, the program checks if
this BQF file has been generated with the proper spectral grid. If this is not
the case, the existing BQF file is overwritten with the correct BQF
file. During a wave model run with various depths, the optimal BQF is used, by
looking at the nearest water depths for which a valid BQF file has been
generated. In addition, the result is rescaled using the ratio of the depth
scaling factors (\ref{eq:snl_shal}) for the target depth and the depth
corresponding to the BQF file.


% -------------------------------------------------------------
\vsssub
\subsubsection{~Input and dissipation (\wam-3)} \label{sec:wam}
\vsssub

The input and dissipation source terms of \wam\ cycles 1 through 3 are based
on \cite{art:Sea81} and \cite{art:KHH84} \citep[see also][]{art:WAM88}. The
input source term is given as

%-------------%
% WAM-3 input %
%-------------%
% eq:Snyder
% eq:Wu

\begin{equation}
\cS_{in}(k,\theta) = C_{in} \frac{\rho_a}{\rho_w} \max
\left [ 0 , \left (
\frac{28 \, u_\ast}{c} \cos ( \theta - \theta_w ) - 1
\right ) \right ]
\: \sigma \: N(k,\theta) \; , \label{eq:Snyder}
\end{equation}
\begin{equation}
u_\ast = u_{10} \sqrt{(0.8 + 0.065u_{10})10^{-3}}
\: , \label{eq:Wu}
\end{equation}

\noindent
where $C_{in}$ is a constant $(C_{in} = 0.25)$, $\rho_a$ $(\rho_w)$ is the
density of air (water), $u_\ast$ is the wind friction velocity
\citep{art:Cha55,art:Wu82}, $c$ is the phase velocity $\sigma/k$, $u_{10}$ is
the wind speed at 10~m above the mean sea level and $\theta_w$ is the mean
wind direction. The corresponding dissipation term is given as

%-------------------%
% WAM-3 dissipation %
%-------------------%
% eq:Snyder_ds
% eq:sigma_hat
% eq:alpha_hat

\begin{equation}
\cS_{ds}(k,\theta) = C_{ds} \, \hat{\sigma} \, \frac{k}{\hat{k}}
\left ( \frac{\hat{\alpha}}{\hat{\alpha}_{PM}} \right ) ^2
N(k,\theta) \; , \label{eq:Snyder_ds}
\end{equation}
\begin{equation}
\hat{\sigma} = \left ( \overline{\sigma^{-1}} \right) ^{-1} \: ,
\label{eq:sigma_hat}
\end{equation}
\begin{equation}
\hat{\alpha} = E \, \hat{k}^2 \,g^{-2} \: ,
\label{eq:alpha_hat}
\end{equation}

\noindent
where $C_{ds}$ is a constant $(C_{ds} = -2.36 \: 10^{-5})$,
$\hat{\alpha}_{PM}$ is the value of $\hat{\alpha}$ for a {\sc pm} spectrum
$(\hat{\alpha}_{PM} = 3.02\:10^{-3})$ and where $\hat{k}$ is given by
Eq.~(\ref{eq:k_hat}).

The parametric tail [Eqs.~(\ref{eq:tail_E_f}) and (\ref{eq:tail_N_k})]
corresponding to these source terms is given by\footnote{~originally, \wam\
used $m = 5$, present setting used for consistent limit behavior
\cite[e.g.,][]{tol:JPO92}.} $m = 4.5$ and by

%------------%
% WAM-3 tail %
%------------%
% eq:tail_WAM3
% eq:f_PM

\begin{equation}
f_{hf} = \max \left [ \: 2.5 \, \hat{f}_r \: , \: 4 \,
f_{r,PM} \: \right ] \: ,
\label{eq:tail_WAM3}
\end{equation}
\begin{equation}
f_{r,PM} = \frac{g}{28 \, u_\ast} \: ,
\label{eq:f_PM}
\end{equation}

\noindent
where $f_{r,PM}$ is the \cite{art:PM64} frequency, estimated from the wind
friction velocity $u_\ast$. The shape and attachment point of this tail is
hardwired to the present model. The tunable parameters $C_{in}$, $C_{ds}$ and
$\alpha_{PM}$ are preset to their default values, but can be redefined by the
user in the input files of the model.


% -------------------------------------------------------------
\vsssub
\subsubsection{~Input and dissipation (Tolman and Chalikov)}
\label{sec:t&c} \vsssub

The source term package of \cite{tol:JPO96} consists of the input source term
of \cite{art:CB93} and \cite{art:Cha95}, and two dissipation constituents. The
input source term is given as

%----------------------------%
% Chalikov an Belevich input %
%----------------------------%
% eq:CB93_gen

\begin{equation}
\cS_{in}(k,\theta) = \sigma \, \beta \, N(k,\theta)
\: , \label{eq:CB93_gen} \end{equation}

\noindent
where $\beta$ is a nondimensional wind-wave interaction parameter, which is
approximated as

% eq:CB93_beta

\begin{equation}
10^4 \beta = \left \{
\begin{array}{ccrcl}
-a_1\toa^2 -a_2          &,&             & \toa & \leq -1     \\
a_3\toa(a_4\toa-a_5)-a_6 &,&         -1< & \toa & <\Omega_1/2 \\
(a_4\toa-a_5)\toa        &,& \Omega_1/2< & \toa & <\Omega_1   \\
a_7\toa-a_8              &,&   \Omega_1< & \toa & <\Omega_2   \\
a_9(\toa-1)^2+a_{10}     &,&   \Omega_2< & \toa &
\end{array} \right . \label{eq:CB93_beta}
\end{equation}

\noindent
where

% eq:CB93_oma

\begin{equation}
\toa= \frac{\sigma \; u_{\lambda}}{g} \cos(\theta-\theta_w)
\label{eq:CB93_oma} \end{equation}

\noindent
is the non-dimensional frequency of a spectral component, $\theta_w$ is the
wind direction and $u_{\lambda}$ is the wind velocity at a height equal to the
`apparent' wave length

% eq:CB93_lam

\begin{equation}
\lambda_a = \frac{ 2 \pi }{ k | \cos(\theta-\theta_w) | }
\: . \label{eq:CB93_lam} \end{equation}

\noindent
The parameters $a_1-a_{10}$ and $\Om_1,\Om_2$ in Eq.~(\ref{eq:CB93_beta})
depend on the drag coefficient $\CL$ at the height $z=\lambda_a$:

% eq:omapar        Approximation parameters

\begin{equation} \begin{array}{lcl}
\Om_1=1.075+75\CL  &\Om_2=& 1.2+300\CL                     \\
a_1=0.25+395\CL,    &a_3 =& (a_0-a_2-a_1)/(a_0-a_4+a_5)    \\
a_2=0.35+150\CL,    &a_5 =& a_4\Om_1                       \\
a_4=0.30+300\CL,    &a_6 =& a_0(1-a_3)                     \\
a_9=0.35+240\CL,    &a_7 =&
                     (a_9(\Om_2-1)^2+a_{10})/(\Om_2-\Om_1) \\
a_{10}=-0.05+470\CL,&a_8 =& a_7\Om_1                       \\
                    &a_0 =& 0.25 a_5^2/a_4
\end{array} \label{eq:omapar} \end{equation}

\noindent
The wave model takes the wind $u_r$ at a given reference height $z_r$ as its
input, so that $u_\lambda$ and $\CL$ need to be derived as part of the
parameterization. Excluding a thin surface layer adjusting to the water
surface, the mean wind profile is close to logarithmic

% eq:u_z

\begin{equation}
u_z = \frac{v_\ast}{\kappa} \ln \left ( \frac{z}{z_0} \right )
\: , \label{eq:u_z}
\end{equation}

\noindent
where $\kappa = 0.4 $ is the Von K\`{a}rm\`{a}n constant, and $z_0$ is the
roughness parameter. This equation can be rewritten in terms of the drag
coefficient $C_r$ at the reference height $z_r$ as \citep{art:Cha95}

% eq:C95C
% eq:C95R
% eq:C95Ca

\begin{equation}
C_r = \kappa^2 \left [ R - \ln(C) \right ] ^2
\: , \label{eq:C95C} \end{equation} where \begin{equation}
R = \ln \left ( \frac{z_r g}{\chi \sqrt{\alpha} u_r^2} \right )
\: , \label{eq:C95R} \end{equation}

\noindent
where $\chi = 0.2$ is a constant, and where $\alpha$ is the conventional
nondimensional energy level at high frequencies. An accurate explicit
approximation to these implicit relations is given as

\begin{equation}
C_r = 10^{-3} \left ( 0.021 + \frac{10.4}{R^{1.23}+1.85} \right )
\: . \label{eq:C95Ca} \end{equation}

\noindent
The estimation of the drag coefficient thus requires an estimate of the
high-frequency energy level $\alpha$, which could be estimated directly from
the wave model. However, the corresponding part of the spectrum is generally
not well resolved, tends to be noisy, and is tainted by errors in several
source terms. Therefore, $\alpha$ is estimated parametrically as
\citep{art:Jan89}

% eq:alpha_J89

\begin{equation}
\alpha = 0.57 \left ( \frac{u_\ast}{c_p} \right )^{3/2}
\: . \label{eq:alpha_J89} \end{equation}

\noindent
As the latter equation depends on the drag coefficient, Eqs.~(\ref{eq:C95R})
through (\ref{eq:alpha_J89}) formally need to be solved iteratively. Such
iterations are performed during the model initialization, but are not
necessary during the actual model run, as $u_\ast$ generally changes
slowly. Note that Eq.~(\ref{eq:alpha_J89}) can be considered as an internal
relation to the parameterization of $C_r$, and can therefore deviate from
actual model behavior without loss of generality. In \cite{tol:JPO96}, $C_r$
is therefore expressed directly in terms of $c_p$.

Using the definition of the drag coefficient and Eq.~(\ref{eq:u_z}) the
roughness parameter $z_0$ becomes

% eq:z0

\begin{equation}
z_0 = z_r \; \exp \left ( - \kappa C_r^{-1/2} \right )
\; , \label{eq:z0} \end{equation}

\noindent
and the wind velocity and drag coefficient at height $\lambda$ become

% eq:ul
% eq:Cl

\begin{equation}
u_{\lambda} = u_r \frac{ln(\lambda_a/z_0)}{ln(z_r/z_0)}
\label{eq:ul} \end{equation} \begin{equation}
C_{\lambda} = C_r \left ( \frac{u_a}{u_\lambda}
\right ) ^2 \label{eq:Cl}
\end{equation}

\noindent
Finally, Eq.~(\ref{eq:alpha_J89}) requires an estimate for the peak frequency
$f_p$. To obtain a consistent estimate of the peak frequency of actively
generated waves, even in complex multimodal spectra, this frequency is
estimated from the equivalent peak frequency of the positive part of the input
source term \citep[see][]{tol:JPO96}

% eq:fp_ir

\begin{equation}
f_{p,i} =
\frac { \int \int \: f^{-2} \: c_g^{-1} \:
\max \: [ \: 0 \:,\: \cS_{wind}(k,\theta) \: ] \: d f \: d\theta }
{ \int \int \: f^{-3} \: c_g^{-1} \:
\max \: [ \: 0 \:,\: \cS_{wind}(k,\theta) \: ] \: d f \: d\theta }
\: , \label{eq:fp_ir}
\end{equation}

\noindent
from which the actual peak frequency is estimated as (the tilde identifies
nondimensional parameter based on $u_\ast$ and $g$)

% eq:fp_fpi

\begin{equation}
\tilde{f}_p \: = \: 3.6 \: 10^{-4} \: + \: 0.92 \tilde{f}_{p,i}
\: - \: 6.3 \: 10^{-10} \: \tilde{f}_{p,i}^{-3}
\:\: . \label{eq:fp_fpi} \end{equation}

\noindent
All constants in the above equations are defined within the model. The user
only defines the reference wind height $z_r$.

During testing of a global implementation of \ws\ including this source term
\citep{tol:OMB02a}, it was found that its swell dissipation due to opposing or
weak winds was severely overestimated. To correct this deficiency, a filtered
input source term is defined as

% eq:swellf         Input source term (modified)

\begin{equation}
\cS_{i,m} = \left \{ \begin{array}{ccccc}
    \cS_i         & \mbox{for} & \beta \geq 0 & \mbox{or}  & f > 0.8 f_p \\
  X_s \cS_i       & \mbox{for} & \beta < 0    & \mbox{and} & f < 0.6 f_p \\
{\cal{X}}_s \cS_i & \mbox{for} & \beta < 0    & \mbox{and} & 06 f_p < f < 0.8 f_p
\end{array} \right . \: , \label{eq:swellf} \end{equation}

\noindent
where $f$ is the frequency, $f_p$ is the peak frequency of the wind sea as
computed from the input source term, $\cS_i$ is the input source term
(\ref{eq:CB93_gen}), and $0 < X_s < 1$ is a reduction factor for $\cS_i$,
which is applied to swell with negative $\beta$ only (defined by the
user). ${\cal{X}}_s$ represents a linear reduction of $X_s$ with $f_p$
providing a smooth transition between the original and reduced input.

The drag coefficient that follows from Eq.~(\ref{eq:alpha_J89}) becomes
unrealistically high for hurricane strength wind speeds, leading to
unrealistically high wave growth rates. To alleviate this, the drag
coefficient at the reference height $C_r$ can be capped with a maximum allowed
drag coefficient $C_{r,max}$, either as a simple hard limit

\begin{equation}
C_r = \min ( C_r , C_{r,max} \:\:\: , \label{eq:Cd_cap_1}
\end{equation}

\noindent
or with a smooth transition

\begin{equation}
C_r = C_{r,max} \tanh ( C_r / C_{r,max} ) \:\:\: . \label{eq:Cd_cap_2}
\end{equation}

\noindent
Selection of the capped drag coefficient occurs at the compile stage of the
code. The cap level and cap type can be set by the user. Defaults settings are
$C_{r,max} = 2.5 \:10^{-3}$ and Eq.~(\ref{eq:Cd_cap_1}).

\vspace{\baselineskip}
\noindent
The corresponding dissipation source term consists of two constituents.  The
(dominant) low-frequency constituent is based on an analogy with energy
dissipation due to turbulence,

%-------------------------------%
% TC, low frequency dissipation %
%-------------------------------%
% eq:TCdl
% eq:h
% eq:phi

\begin{equation}
\cS_{ds,l}(k,\theta) = -2 \: u_{\ast} \: h \: k^2 \phi
\: N(k,\theta) \: , \label{eq:TCdl}
\end{equation} \begin{equation}
h = 4\left(\int_{0}^{2\pi} \int_{f_h}^{\infty} \: F(f,\theta) \:
d f \: d\theta \right)^{1/2} \: . \label{eq:h} \end{equation} \begin{equation}
\phi = b_0 + b_1 \tilde{f}_{p,i}  + b_2 \tilde{f}_{p,i} ^{- b_3}
\: . \label{eq:phi} \end{equation}

\noindent
where $h$ is a mixing scale determined from the high-frequency energy content
of the wave field and where $\phi$ is an empirical function accounting for the
development stage of the wave field. The linear part of Eq.~(\ref{eq:phi})
describes dissipation for growing waves. The nonlinear term has been added to
allow for some control over fully grown conditions by defining a minimum value
for $\phi$ ($\phi_{\min}$) for a minimum value of $f_{p,i}$
($f_{p,i,\min}$). If $\phi_{\min}$ is below the linear curve, $b_2$ and $b_3$
are given as

% eq:b_21
% eq:b_31

\begin{equation}
b_2 = \tilde{f}_{p,i,\min}^{b_3} \: \left ( \phi_{\min} - b_0
- b_1 \tilde{f}_{p,i,\min} \right ) \: , \label{eq:b_21}
\end{equation} \begin{equation}
b_3 = 8 \: . \label{eq:b_31}
\end{equation}

\noindent
If $\phi_{\min}$ is above the linear curve, $b_2$ and $b_3$ are given as

% eq:f_a           Auxiliary frequency
% eq:b_22          Equation b_2 above
% eq:b_32          Equation b_3 above

\begin{equation}
\tilde{f}_a = \frac{\phi_{\min} - b_0}{b_1} \:\:\: , \:\:\:
\tilde{f}_b = \max \: \left \{ \: \tilde{f}_a - 0.0025 \: , \:
\tilde{f}_{p,i,\min} \: \right \} \:\:\: , \label{eq:f_a}
\end{equation} \begin{equation}
b_2 = \tilde{f}_b^{b_3} \left [ \phi_{\min} - b_0 -
b_1 \tilde{f}_b \right ] \: , \label{eq:b_22}
\end{equation} \begin{equation}
b_3 = \frac{b_1 \tilde{f}_b}{\phi_{\min} -b_0 -b_1 \tilde{f}_b}
\: . \label{eq:b_32}
\end{equation}

\noindent
The above estimate of $b_3$ results in $\partial \phi / \partial
\tilde{f}_{p,i} = 0$ for $\tilde{f}_{p,i} = \tilde{f}_b$. For $\tilde{f}_{p,i}
< \tilde{f}_b$, $\phi$ is kept constant ($\phi = \phi_{\min}$).

\vspace{\baselineskip} \noindent
The empirical high-frequency dissipation is defined as

%--------------------------------%
% TC, high frequency dissipation %
%--------------------------------%
% eq:TCdh

\begin{equation}
\cS_{ds,h}(k,\theta) = - a_0 \left ( \frac{u_\ast}{g} \right ) ^2  f^3 \:
\alpha_n^B \: N(k,\theta) \:\:\: , \label{eq:TCdh}
\end{equation} \begin{displaymath}
B = a_1 \left( \frac{ f u_\ast}{g} \right ) ^{-a_2}
\:\:\: , \end{displaymath} \begin{equation}
\alpha_n = \frac{\sigma^6}{c_g \: g^2 \alpha_r} \int_0^{2\pi} N(k,\theta) \: d\theta
\:\:\: , \label{eq:alpha_n} \end{equation}

\noindent
where $\alpha_n$ is Phillips' nondimensional high-frequency energy level
normalized with $\alpha_r$, and where $a_0$ through $a_2$ and $\alpha_r$ are
empirical constants. This parameterization implies that $m = 5$ in the
parametric tail, which has been preset in the model. Note that in the model
Eq.~(\ref{eq:alpha_n}) is solved assuming a deep water dispersion relation, in
which case $\alpha_n$ is evaluated as

\begin{equation}
\alpha_n = \frac{2 \: k^3}{\alpha_r}  F(k)
\:\:\: . \label{eq:alpha_n_mod} \end{equation}

\noindent
The two constituents of the dissipation source term are combined using a
simple linear combination, defined by the frequencies $f_1$ and $f_2$.

%-----------------------%
% TC, total dissipation %
%-----------------------%
% eq:TCdtot
% eq:filt_A        Dissipation filter function

\begin{equation}
\cS_{ds}(k,\theta) = {\cal{A}} \cS_{ds,l} +
\left ( 1 - {\cal{A}} \right ) \cS_{ds,h}
\: , \label{eq:TCdtot} \end{equation} \begin{equation}
{\cal A} = \left \{ \begin{array}{ccrclc}
  1  & \;{\rm for}\; &          &\!\!\!f& \!\!\! < f_l & ,\\
\frac{ f-f_2}{f_1-f_2}
     & \;{\rm for}\; & f_1 \leq &\!\!\!f& \!\!\! < f_2 & ,\\
  0  & \;{\rm for}\; & f_2 \leq &\!\!\!f&              & ,
\end{array} \right . \label{eq:filt_A} \end{equation}

\noindent
To enhance the smoothness of the model behavior for frequencies near the
parametric cut-off $f_{hf}$, a similar transition zone is used between the
prognostic spectrum and the parametric high-frequency tail as in
Eq.~(\ref{eq:tail_N_k})

% eq:smtail

\begin{equation}
N(k_i,\theta) = \left ( 1 - {\cal{B}} \right ) N(k_{i},\theta) +
{\cal{B}} N(k_{i-1},\theta) \left ( \frac{f_i}{f_{i-1}}\right ) ^{-m-2}
\: , \label{eq:smtail}
\end{equation}

\noindent
where $i$ is a discrete wavenumber counter, and where $\cal{B}$ is defined
similarly to $\cal{A}$, ranging from 0 to 1 between $f_2$ and $f_{hf}$.

The frequencies defining the transitions and the length scale $h$ are
predefined in the model as

% eq:TC_f

\begin{equation} \left . \begin{array}{lll}
  f_{hf} & = & 3.00 \: f_{p,i}  \\
  f_1 & = & 1.75 \: f_{p,i}  \\
  f_2 & = & 2.50 \: f_{p,i}  \\
  f_h & = & 2.00 \: f_{p,i}
\end{array} \:\:\: \right \rbrace \:\:\: . \label{eq:TC_f} \end{equation}

\noindent
Furthermore, $f_{p,i,\min} = 0.009$ and $\alpha_r = 0.002$ are preset in the
model. All other tunable parameters have to be provided by the user. Suggested
and default values are given in Table~\ref{tab:TC_par}.

% tab:TC_par

\begin{table} \begin{center}
\begin{tabular}{|l|c|c|c|c|c|c|} \hline \hline
Tuned to :  & $a_0$ &      $a_1$       & $a_2$ &
            $b_0$           & $b_1$  & $\phi_{\min} $\\ \hline
KC stable   &  4.8  & $1.7 \: 10^{-4}$ &  2.0  &
 $ \:\:\:\: 0.3 \: 10^{-3}$ &  0.47  &  0.003  \\
KC unstable &  4.5  & $2.3 \: 10^{-3}$ &  1.5  &
 $     -5.8 \: 10^{-3}$     &  0.60  &  0.003  \\ \hline \hline
\end{tabular} \end{center}
\caption{Suggested constants in the source term package of Tolman and
         Chalikov. KC denotes \cite{art:KC92,ibk:KC94}. First line represents
         default model settings.}
\label{tab:TC_par} \botline \end{table}

Test results of these source terms in a global model implementation
\citep{tol:OMB02a} suggested that (i) the model tuned in the classical way to
fetch-limited growth for stable conditions underestimates deep-ocean wave
growth (a deficiency apparently shared by the WAM model) and that (ii) effects
of stability on the growth rate of waves as identified by
\cite{art:KC92,ibk:KC94} should be included explicitly in the parameterization
of the source terms.  Ideally, both problems would be dealt with by
theoretical investigation of the source terms. Alternatively, the wind speed
$u$ can be replaced by an effective wind speed $u_e$. In \cite{tol:OMB02a} the
following effective wind speed is used :

% eq:scor         Stability correction
% eq:c1
% eq:c2
% eq:stab         Stability parameter

\begin{equation}
\frac{u_e}{u} = \left ( \frac{c_o}{1 + C_1 + C_2} \right )^{-1/2}
\: , \label{eq:scor} \end{equation} \begin{equation}
C_1 = c_1 \tanh \left [ \max ( 0 , f_1 \{ \ST - \ST_o \} ) \right ]
\: , \label{eq:c1} \end{equation} \begin{equation}
C_2 = c_2 \tanh \left [ \max ( 0 , f_2 \{ \ST - \ST_o \} ) \right ]
\: , \label{eq:c2} \end{equation} \begin{equation}
\ST = \frac{h g}{u_h^2} \: \frac{T_a - T_s}{T_0}
\: , \label{eq:stab} \end{equation}

\noindent
where $\ST$ is a bulk stability parameter, and $T_a$, $T_s$ and $T_0$ are the
air, sea and reference temperature, respectively. Furthermore, $f_1 \leq 0$,
$c_1$ and $c_2$ have opposite signs and $f_2 = f_1 c_1 / c_2$. Following
\cite{tol:OMB02a}, default settings of $c_0 = 1.4$, $c_1 = -0.1$, $c_2 = 0.1$,
$f_1 = -150$ and $\ST_o = -0.01$ in combination with the tuning to stable
stratification wave growth data (`KC stable' parameter values in
Table~\ref{tab:TC_par}) are used. Note that this effective wind speed was
derived for winds at 10~m height. The wind correction can be switched off by
the user during compilation of the model, and default parameter settings can
be redefined by the user in the program input files.

% -------------------------------------------------------------
\vsssub
\subsubsection{~Input and dissipation (\wam-4 - ECWAM) \\
\hfill {\rm (F. Ardhuin)}} \label{sec:wam4}
\vsssub

The wind-wave interaction source terms described here are based on the wave growth
theory of \cite{art:Miles57}, modified by \cite{art:Jan82}. The pressure-slope
correlations that give rise to part of the wave generation are parameterized
following \cite{art:Jan91}. A wave dissipation term due to shear stresses
variations in phase with the orbital velocity is added for the swell part of
the spectrum, based on the swell decay observations of \cite{art:ACC08}.

This parameterization was further extended by \cite{rep:AB02} to take into
account a stronger gustiness in unstable atmospheric conditions. This effect is
included in the present parameterization and is activated with the {\code
!/STAB3} switch. Efforts have been made to make the present implementation as
close as possible to the one in the ECWAM model \citep{rep:Bea05}, in
particular the stress lookup tables were verified to be identical. 
Later modifications include the addition of a negative part in the wind input 
to represent swell dissipation.

The source term reads \citep{bk:Jan04}
\begin{equation}
\cS_{in}(k,\theta) =
\frac{\rho_a}{\rho_w}\frac{\beta_{\mathrm{max}}}{\kappa^2}{\mathrm e}^{Z}Z^4
\left(\frac{u_\star}{C}+z_\alpha\right)^2 \cos^{p_{in}}(\theta - \theta_u) \sigma N
\left(k,\theta\right) + S_{out}(k,\theta),\label{eq:SinWAM4}
\end{equation}

\noindent where $\rho_a$ and $\rho_w$ are the air and water densities,
$\beta_{\mathrm{max}}$ is a non-dimensional growth parameter (constant),
$\kappa$ is von K\'{a}rm\'{a}n' constant, and $p_{in}$ is a constant that
controls the directional distribution of $\cS_{in}$. In the present
implementation the air/water density ratio ${\rho_a}/{\rho_w}$ is constant. We
define $Z=\log(\mu)$ where $\mu$ is given by Janssen (1991, eq. 16), and
corrected for intermediate water depths, so that

\begin{equation}
Z=\log(k z_1)+\kappa/\left[\cos\left(\theta - \theta_u\right)
\left(u_\star/C + z_\alpha \right)\right],
\end{equation}

\noindent
where $z_1$ is a roughness length modified by the wave-supported stress
$\tau_w$, and $z_\alpha$ is a wave age tuning parameter\footnote{Although this
tuning parameter $z_\alpha$ is not well described in WAM-Cycle4 documentation,
it has an important effect on wave growth. Essentially it shifts the wave age
of the long waves, which typically increases the growth, and even generates
waves that travel faster than the wind. This accounts for some gustiness in
the wind and should possibly be resolution-dependent. For reference, this
parameter was not properly set in early versions of the SWAN model, as
discovered by R. Lalbeharry.}.  The roughness $z_1$ is defined as,

\begin{eqnarray}
U_{10}&=&\frac{u_\star}{\kappa} \log\left(\frac{z_u}{z_1}\right) \\
z_1&=&\alpha_0 \frac{\tau}{ \sqrt{1-\tau_w/\tau}},
\end{eqnarray}

\noindent
where $\tau=u_\star^2$, and $z_u$ is the height at which the wind is
specified. These two equations provide an implicit functional dependence of
$u_\star$ on $U_{10}$ and $\tau_w/\tau$. This relationship is tabulated
\citep{art:Jan91, rep:Bea07}.

An important part of the parameterization is the calculation of the
wave-supported stress $\tau_w$,

\begin{equation}
\tau_w=\left|\int_0^{k_{\max}} \int_0^{2 \pi} \frac{\cS_{in}(k',\theta)}{C}
\left(\cos \theta, \sin \theta \right)  {\mathrm d} k' \mathrm d \theta +
\tau_{\mathrm{hf}}(u_\star,\alpha) \left(\cos \theta_u, \sin \theta_u \right)
\right|,\label{eq:tauwint}
\end{equation}

\noindent
which includes the resolved part of the spectrum, up to $k_{\max}$, as well as
the stress supported by shorter waves, $\tau_{\mathrm{hf}}$. Assuming a
$f^{-X}$ diagnostic tail beyond the highest frequency, $\tau_{\mathrm{hf}}$ is
given by

\begin{eqnarray}
\tau_{\mathrm{hf}}(u_\star,\alpha)&= &\frac{u_{\star}^2}{g^2}
\frac{\sigma_{\max}^X 2 \pi \sigma }{2 \pi C_g(k_{\max})} \int_0^{2 \pi} N
\left(k_{\max},\theta \right)
\max\left\{0,\cos\left(\theta-\theta_u\right)\right\}^3 d \theta \nonumber \\
& & \times \frac{\beta_{\mathrm{max}}}{\kappa^2}
\int_{\sigma_{\max}}^{0.05*g/u_\star} \frac{{\mathrm
e}^{Z_{\mathrm{hf}}}Z_{\mathrm{hf}}^4}{\sigma^{X-4}} {\mathrm d} \sigma
\label{eq:tauhfint}
\end{eqnarray}

\noindent
where the second integral is a function of $u_\star$ and the Charnock
coefficient $\alpha$ only, which is easily tabulated. In practice the
calculation is coded with $X=5$, and the variable $Z_{\mathrm{hf}}$ is defined
by,

\begin{equation}
Z_{\mathrm{hf}}(\sigma)=\log(k z_1)+\min\left\{\kappa/\left(u_\star/C +
z_\alpha \right),20\right\}.
\end{equation}

\noindent
This parameterization is sensitive to the spectral level at $k_{\max}$.
A higher spectral level will lead to a larger value of $u_\star$ and thus
positive feedback on the wind input via $z_1$. This sensitivity is exacerbated
by the sensitivity of the high frequency spectral level to the presence of
swell via the dissipation term.

A linear damping of swells was introduced in the operational ECWAM model in September 2009. It takes 
the form given by \cite{bk:Jan04} 

\begin{equation}
S_{out}(k,\theta)= 2 s_1  \kappa \frac{\rho_a }{\rho_w} \left(\frac{u_\star}{C}\right)^2 
\left[\cos \left(\theta - \theta_u\right) - \frac{\kappa C}{u_\star \log(k z_0)}\right]
\end{equation}

\noindent where $s_1$ is set to 1 when this damping is used and 0 otherwise. For $s_1=0$ 
the parameterization is the WAM4 or BJA parameterization (see table below). 

Due to the increase in high frequency input compared to WAM3, the dissipation
function was adapted by Janssen (1994) from the WAM3 dissipation, and later
reshaped by \cite{rep:Bea05}. That later modification is referred to as "BJA" for Bidlot, 
Janssen and Abdallah. A more recent modification, strongly improved the model results for 
Pacific swells, at the price of an underestimation of the highest sea states. This 
corresponds to the ECMWF WAM model cotained in the IFS version CY38R1 \citep{pro:Bid12}. 

\noindent
The generic form of the WAM4 dissipation term is,

\begin{equation}
S_{ds}\left(k,\theta\right)^{\mathrm{WAM}} = C_{ds} \overline{\alpha}^2
 \overline{\sigma} \left[\delta_1 \frac{k}{\overline{k}} + \delta_2
\left(\frac{k}{\overline{k}}\right)^2\right]\label{eq:SdsWAM4}
N\left(k,\theta\right)
\end{equation}

\noindent
where $C_{ds}$ is a non-dimensional constant $\delta_1$ and $\delta_2$ are
weight parameters,

\begin{equation}
\overline{k}=\left[\frac{\int k^p N\left(k,\theta\right) {\mathrm d}
\theta}{\int N\left(k,\theta\right) {\mathrm d} \theta}\right]^{1/p}
\end{equation}

\noindent
with $p$ a constant power. Similarly the mean frequency is defined as

\begin{equation}
\overline{\sigma}=\left[\frac{\int \sigma^p N\left(k,\theta\right) {\mathrm d}
\theta}{ \int N\left(k,\theta\right) {\mathrm d} \theta}\right]^{1/p},
\end{equation}

\noindent
so that the mean steepness is $\overline{\alpha}=E \overline{k}^2$.

The mean frequency also occurs in the definition of the maximum frequency of
prognostic integration of the source terms. Since the definition of that
frequency may be different from that of the source term it is defined with
another exponent $p_{\mathrm{tail}}$.

Unfortunately these parameterizations are sensitive to swell. An increase in
swell height typically reduces dissipation at the windsea peak (the first
factor is reduced) and increases dissipation at high frequencies (the second
factor is reduced). For $p< 2$, as in the WAM-Cycle 4 and BJA
parameterizations, this sensitivity is much larger than the expected effect of
short wave modulation by long waves.

The source term code was thus generalized to
allow the use of WAM4, BJA or others ECWAM parameterization, via a simple change of
the parameters in the namelists SIN3 and SDS3. At present, the default values of the namelist
parameters correspond to BJA \citep{rep:Bea05}.

\begin{table} \begin{center}
\begin{tabular}{|l|c|c|c|c|c|} \hline \hline
Par.         &  WWATCH var.           & namelist & WAM4 & BJA   & Bidlot 2012 \\
\hline
  $z_u$ &  ZWND                       & SIN3 & 10.0    & 10.0   & 10.0   \\
  $\alpha_0$ &  ALPHA0                & SIN3 & 0.01    & 0.0095 &  0.0095 \\
  $\beta_{\mathrm{max}}$ & BETAMAX    & SIN3 & 1.2     & 1.2    & 1.2  \\
  $p_{\mathrm{in}}$ &  SINTHP         & SIN3 & 2       & 2      & 2  \\
  $z_\alpha$ &  ZALP                  & SIN3 & 0.0110  & 0.0110 &  0.0080 \\
  $s_1$ &  SWELLF                     & SIN3 & 0.0     & 0.0    & 1.0   \\
\hline
\end{tabular} \end{center}
\caption{Parameter values for WAM4, BJA and the 2009 update in the ECWAM model. Source term
parameterizations that can be reset via the SIN3 and SDS3 namelist. BJA is
generally better than WAM4. The default parameters in ST3 corresponds to BJA. Please
note that the name of the variables only apply to the namelists. In the source
term module the names are slightly different, with a doubled first letter, in
order to differentiate the variables from the pointers to these variables.} \label{tab:WAM4_parSIN}
\end{table}

\begin{table} \begin{center}
\begin{tabular}{|l|c|c|c|c|c|} \hline \hline
Par.                               &  WWATCH var.         & namelist & WAM4 & BJA   & Bidlot 2012 \\
\hline
  $C_{\mathrm{ds}}$                 &  SDSC1          & SDS3 & -4.5 & -2.1& -1.33       \\
  $p$                               &  WNMEANP        & SDS3 & -0.5 & 0.5 &  0.5        \\
  $p_{\mathrm{tail}}$               &  WNMEANPTAIL    & SDS3 & -0.5 & 0.5 &  0.5        \\
  $\delta_1$                        &  SDSDELTA1      & SDS3 & 0.5  & 0.4 &  0.5        \\
  $\delta_2$                        &  SDSDELTA2      & SDS3 & 0.5  & 0.6 &  0.5 \\
  \hline \hline
\end{tabular} \end{center}
\caption{Parameter values for WAM4, BJA and the update by \cite{pro:Bid12}. Source term
parameterizations that can be reset via the SDS3 namelist. BJA is generally
better than WAM4. Please note that the
name of the variables only apply to the namelists. In the source term module
the names are slightly different, with a doubled first letter, in order to
differentiate the variables from the pointers to these variables.} \label{tab:WAM4_parSDS}
\end{table}

% -------------------------------------------------------------
\vsssub
\subsubsection{~Input and dissipation (Ardhuin et al. 2010)} \label{sec:wam4}
\vsssub

This parameterization uses a positive part of the wind input that is takem from WAM4, with an ad hoc reduction of $u_\star$ is
implemented in order to allow a balance with a saturation-based dissipation.
This correction also reduces the drag coefficient at high winds. This is done by reducing 
the wind input for high frequencies and high winds. For this,  $u_\star$ in eq. (\ref{eq:SinWAM4}) is replaced 
by $u_\star '(k)$
defined for each frequency as

\begin{equation}
\left(u_\star '\right)^2=\left|u_\star^2 \left(\cos \theta_u, \sin
\theta_u \right) - \left|s_u\right| \int_0^k \int_0^{2 \pi}
\frac{S_{in}\left(k',\theta \right)}{C}  \left(\cos \theta, \sin
\theta \right)  {\mathrm d} k' \mathrm d
\theta,\label{ustarp}\right|
\end{equation}

\noindent
where the sheltering coefficient $\left|s_u\right|\sim 1$ can be used to tune
the stresses at high winds, which would be largely overestimated for
$s_u=0$. For $s_u > 0$ this sheltering is also applied within the diagnostic
tail in eq. (\ref{eq:tauhfint}), which requires the estimation of a
3-dimensional look-up table for the high frequency stress, the third parameter
being the energy level of the tail.

The swell dissipation parameterization of \cite{art:ACC08} is activated by setting $s_0$ to a non-zero integer value, and is given
by a combination of the viscous boundary layer value, 

\begin{equation}
\cS_{out,vis}\left(k,\theta\right) = - s_5 \frac{\rho_a}{\rho_w}\left\{ 2 k \sqrt{2
\nu \sigma}\right\}  N \left(k,\theta\right) \label{Sds_turb},\label{eq:Dore}
\end{equation}

\noindent
with the turbulent boundary layer expression 
\begin{equation}
\cS_{out,tur} \left(k,\theta\right) = - \frac{\rho_a}{\rho_w}\left\{  16 f_e
\sigma^2 u_{\mathrm{orb},s} / g \right\}
 N\left(k,\theta\right) \label{Sds_visc}.\label{eq:swell_turb}
\end{equation}

\noindent
giving the full term 
\begin{equation}
\cS_{out} \left(k,\theta\right) = r_{vis} \cS_{out,vis}\left(k,\theta\right)  + 
 r_{tur} \cS_{out,tur}\left(k,\theta\right)  
 \label{eq:swell_comb}
\end{equation}

\noindent
where the two weights $ r_{vis} $ and $r_{tur}$ are defined from 
a modified  air-sea boundary layer significant Reynolds number $\mathrm{Re} = 2
u_{\mathrm{orb},s} H_s / \nu_{a}$ 

\begin{eqnarray}
 r_{vis} &=& 0.5 (1- \tanh((\mathrm{Re}-\mathrm{Re}_{c})/s_7) \\
 r_{tur}&=& 0.5 (1+ \tanh((\mathrm{Re}-\mathrm{Re}_{c})/s_7) 
\end{eqnarray}
The significant surface orbital velocity is defined by
\begin{equation} u_{\mathrm{orb},s} = 2 \left [  \int \!\!\!\! \int
      \sigma^3 \: N(k,\theta) \: dk d\theta \right ] ^{1/2}
      \: . \label{eq:ub_orbs} \end{equation}

\noindent
The first equation (\ref{eq:Dore}) is the linear viscous decay by
\cite{art:Dore78}, with $\nu_a$ the air viscosity and $s_5$ is an $O(1)$
tuning parameter. A few tests have indicated that a threshold Re$_{c}=2 \times 10^5 \times (4~\mathrm{m}/H_s)^{(1-s_6)}$ provides reasonable result with 
$s_6=0$, although it may also be a function of the wind speed, and we have no explanation for the dependence on $H_s$. 
With $s_6=1$, a constant threshold close to $2 \times 10^5$ provides similar -- but less accurate -- results. 


\begin{landscape}
\begin{table} \begin{center}
\begin{tabular}{|l|c|c|c|c|c|c|} \hline \hline
Par.         &  WWATCH var.       & namelist & TEST451 & TEST451f & TEST405  & TEST500 \\
\hline
  $z_u$ &  ZWND                       & SIN4 & 10.0    & 10.0    & 10.0      & 10.0 \\
  $\alpha_0$ &  ALPHA0                & SIN4 & 0.0095  & 0.0095   & 0.0095    &  0.0095 \\
  $\beta_{\mathrm{max}}$ & BETAMAX    & SIN4 & 1.52    &\textbf{1.33}& \textbf{1.55}    &  1.52   \\
  $p_{\mathrm{in}}$ &  SINTHP         & SIN4 & 2       & 2       & 2         &  2      \\
  $z_\alpha$ &  ZALP                  & SIN4 & 0.006   & 0.006   & 0.006     &  0.006 \\
  $s_u$ &  TAUWSHELTER                & SIN4 & 1.0     & 1.0     & \textbf{0.0} & 1.0   \\
  $s_1$ &  SWELLF                     & SIN4 & 0.8     & 0.8     & 0.8       &  0.8 \\
  $s_2$ &  SWELLF2                    & SIN4 & -0.018  & -0.018  & -0.018    &  -0.018 \\
  $s_3$ &  SWELLF3                    & SIN4 &  0.015  &  0.015  &  0.015    &  0.015 \\
  $\mathrm{Re}_c$ &  SWELLF4                    & SIN4 & $10^5$  & $10^5$  & $10^5$    & $10^5$  \\
  $s_5$ &  SWELLF5                    & SIN4 & 1.2     & 1.2     & 1.2       &  1.2 \\
  $s_6$ &  SWELLF6                    & SIN4 & 0.      & 0.      & 0.        & 0.   \\
  $s_7$ &  SWELLF7                    & SIN4 & 2.3$\times 10^5$ & 2.3$\times 10^5$  & 0.0       &  0.0 \\
  $z_r$ &  Z0RAT                      & SIN4 & 0.04    & 0.04    & 0.04      &  0.04 \\
  $z_{0,\max}$ &  Z0MAX               & SIN4 & 1.002   & 1.002   &\textbf{0.002}&  1.002 \\
\hline
\end{tabular}
 \end{center}
\caption{Parameter values for TEST451, TEST451f, TEST405 and TEST500 source term
parameterizations that can be reset via the SIN4 namelist. TEST451 generally provides the best 
results at global scale when using ECMWF winds, with the only serious problem being a low bias for $H_s > 8$~m. 
TEST451f corresponds to a retuning for CSFR wind reanalysis from NCEP/NCAR \citep{art:CFSR10}, and 
has almost no bias all the way to $H_s = 15$~m. Simumations and papers prepared before March 2012, 
used a slightly different TEST441 and TEST441f which can be recovered by setting SWELLF7 to 0. 
TEST405 
is slightly superior for short fetches, and TEST500 is intermediate in terms of quality 
but it also includes depth-induced breaking in the same formulation, 
and thus may be more appropriate for depth-limited conditions.
 Please
note that the name of the variables only apply to the namelists. In the source
term module the names are slightly different, with a doubled first letter, in
order to differentiate the variables from the pointers to these variables, and
the SWELLFx are combined in one array SSWELLF. Bold values are different from the 
default values set by ww3\_grid.} \label{tab:ST4_parSIN}
\end{table}
\end{landscape}



Eq. (\ref{eq:swell_turb}) is a parameterization for the
nonlinear turbulent decay. When comparing model results to observations, it
was found that the model tended to underestimate large swells and overestimate
small swells, with regional biases. This defect is likely due, in part, to
errors in the generation or non-linear evolution of theses swells. However, it
was chosen to adjust $f_e$ as a function of the wind speed and direction,

\begin{equation}
f_e = s_1 f_{e,GM} + \left[\left|s_3\right| + s_2 \cos
(\theta-\theta_u)\right]u_\star / u_{\mathrm{orb}},\label{fevar}
\end{equation}

\noindent
where $f_{e,GM}$ is the friction factor given by Grant and Madsen's
(1979)\nocite{art:GM79} theory for rough oscillatory boundary layers without a
mean flow, using a roughness length adjusted to $r_z$ times the roughness for
the wind $z_1$. The coefficients $s_1$ is an $O(1)$ tuning parameter, and the
coefficients $s_2$ and $s_3$ are two other adjustable parameters for the
effect of the wind on the oscillatory air-sea boundary layer. When $s_2 < 0$,
wind opposing swells are more dissipated than following swells. Further, if
$s_3 > 0$, $\cS_{out}$ is applied to the entire spectrum and not just the
swell.

\noindent
The dissipation term is parameterized from the wave spectrum saturation. Because the directional wave spectrum 
were too narrow when using a 
saturation spectrum integrated over the full circle \citep{art:AL06},
we restricted the integration over a sector of half-width $\Delta_\theta$, 
\begin{equation}
B'\left(k,\theta\right)=
\int_{\theta-\Delta_\theta}^{\theta+\Delta_\theta} \sigma k^3 cos^{\mathrm{sB}}\left(\theta-
\theta^{\prime}\right) N(k,\theta^{\prime}) \mathrm d
\theta^{\prime} \label{defBofkprime},
\end{equation}
As a result, a sea state with two systems of same energy but opposite direction will typically produce less dissipation than a sea state 
with all the energy radiated in the same direction. 

We finally define our dissipation term as the sum of the saturation-based term and a cumulative breaking term
$S_{\mathrm{bk,cu}}$, 
\begin{eqnarray}
\cS_{ds}(k,\theta)& =&  \sigma
 \frac{C_{\mathrm{ds}}^{\mathrm{sat}}}{B^2_r} \left[ \delta_d
\max\left\{ B\left(k\right) -
B_r,0\right\}^2 \right.
\nonumber \\
  & & +  \left(1-\delta_d \right) \left. \max\left\{B'\left(k,\theta \right)- B_r
 ,0\right\}^2\right]N(k,\theta)  \nonumber \\
 & & + \cS_{\mathrm{bk,cu}}(k,\theta) + \cS_{\mathrm{turb}}(k,\theta) \label{Sds_all}.
\end{eqnarray}
where
\begin{equation}
B\left(k \right)=\max\left\{B'(k,\theta), \theta \in [0,2
\pi[\right\} \label{defBof}.
\end{equation}
The combination of an isotropic part (the term that multiplies $ \delta_d$) and a direction-dependent part (the term with  $1-\delta_d$) was intended
 to allow some control of the directional spread in resulting spectra. 

The cumulative breaking term $\cS_{\mathrm{bk,cu}}$ represents the smoothing of the
surface by big breakers with celerity $C'$ that wipe out smaller
waves of phase speed $C$. Due to
uncertainties in the estimation of this effect in various observations,
we use the theoretical model of \cite{art:Aea09}. Briefly,
the relative velocity of the crests is the norm of the vector
difference, $\Delta_C =\left|\mathbf{C}-\mathbf{C}'\right|$, and
the dissipation rate of short wave is simply the rate of passage
of the large breaker over short waves, i.e. the integral of
$\Delta_C \Lambda(\mathbf{C}) d\mathbf{C}$, where $\Lambda
(\mathbf{C}) d\mathbf{C}$ is the length of breaking crests per
unit surface that have velocity components between $C_x$ and
$C_x+dC_x$, and between $C_y$ and $C_y+dC_y$ \citep{art:Phi85}.
Here $\Lambda$ is inferred from breaking
probabilities. Based on  Banner et al. (2000, figure 6, $b_T=22 \left(\varepsilon-0.055\right)^2$)\nocite{art:BBY00}, and
taking their saturation parameter $\varepsilon$ to be of the order
of $1.6 \sqrt{B'(k,\theta)}$, the breaking probability of dominant waves
waves is approximately
\begin{equation}
P=56.8\left(\max\{\sqrt{B'(k,\theta)}-\sqrt{B'_r},0\}\right)^2.\label{PBanner}
\end{equation}
However, because they used a zero-crossing analysis, 
for a given wave scale, there are many times when waves are not counted because the record is dominated by another scale: in their analysis there is only one wave at any given time.
This tends to overestimate the breaking probability by a factor of 2 \citep{art:FAB10}, compared to the present approach in which we consider that several waves (of different scales) 
may be present at the same place and time. We correct for this effect simply, dividing 
$P$ by 2. 

With this approach the spectral density of crest length (breaking or not)  per unit surface
$l(\mathbf{k})$ such that $\int l(\mathbf{k}) \mathrm{d}k_x \mathrm{d}k_y$, we take
\begin{equation}
l(\mathbf{k})= 1/(2\pi^2 k),
\end{equation}
and the spectral density of breaking crest length per unit surface is 
$\Lambda(\mathbf{k})=l(\mathbf{k})P(\mathbf{k})$. 
Assuming that any breaking wave instantly dissipates all the energy of all waves with frequencies higher by a factor $r_{\mathrm{cu}}$ or more,
the cumulative dissipation rate is simply given by the rate at which these shorter waves are taken over by larger breaking waves, times the spectral density, namely 
\begin{equation}
\cS_{\mathrm{bk,cu}}(k,\theta) = -C_{\mathrm{cu}}  N \left(k,\theta\right) \int_{f' < r_{\mathrm{cu}} f } \Delta_C \Lambda(\mathbf{k'}) \mathrm{d\mathbf{k'}},
\label{Sds_cu1}
\end{equation}
where $r_{\mathrm{cu}}$ defines the maximum ratio of the frequencies of long waves that will wipe out short waves. 
This  gives the
source term, 
\begin{eqnarray}
\cS_{\mathrm{bk,cu}}(k,\theta) &=&  \frac{-14.2 C_{\mathrm{cu}}}{\pi^2}  N \left(k,\theta\right)
 \nonumber \\
& &\int_0^{ r^2_{\mathrm{cu}} k }\int_0^{2\pi}
\max \left\{\sqrt{B(f',\theta')}-\sqrt{B_r},0\right\}^2
\mathrm{d}\theta' \mathrm{d}k'.
\label{Sds_sat_isotropic}
\end{eqnarray}
We shall 
take $r_{\mathrm{cu}}=0.5$, and $C_{\mathrm{cu}}$ is a tuning coefficient expected to be of order 1, which also corrects for errors in the estimation of $l$. 
\begin{table} \begin{center}
\begin{tabular}{|l|c|c|c|c|c|} \hline \hline
Par.         &  WWATCH var. & namelist & TEST451 & TEST405  & TEST500 \\
\hline
  $p$                               &  WNMEANP        & SDS4 & 0.5                   & 0.5 &  0.5    \\
  $p_{\mathrm{tail}}$               &  WNMEANPTAIL    & SDS4 & 0.5                   & 0.5 &  0.5 \\
  $f_{\mathrm{FM}}$                 &  FXFM3          & SDS4 & 9.9                   & \textbf{2.5} &  9.9  \\
                                    & SDSC1           & SDS4 & 0   & 0                              & \textbf{1.0} \\
  $C_{\mathrm{ds}}^{\mathrm{sat}}$  & SDSC2           & SDS4 & $-2.4\times 10^{-5}$  & $-2.2\times 10^{-5}$  & \textbf{0.0} \\
  $C_{\mathrm{ds}}^{\mathrm{BCK}}$  & SDSBCK          & SDS4 & 0                     & 0  & \textbf{0.185} \\
  $C_{\mathrm{ds}}^{\mathrm{HCK}}$  & SDSHCK           & SDS4 & 0                    & 0  & \textbf{1.5} \\
  $\Delta_\theta$                   &  SDSDTH         & SDS4 & 80                    & 80 &  80 \\
  $B_r$                             &  SDSBR          & SDS4 & 0.0009                & \textbf{0.00085} & 0.0009    \\
  $C_{\mathrm{cu}}$                 & SDSCUM         & SDS4 & -0.40344               & \textbf{0.0}    & -0.40344     \\
  ${\mathrm{s_B}}$                  & SDSCOS           &SDS4 & 2.0                   &  0.0 & 2.0 \\
   $B_0$                             &  SDSC4          & SDS4 & 1.0                  & 1.0 & 1.0   \\
  $p^{\mathrm{sat}}$                &  SDSP           & SDS4 & 2.0  & 2.0 &  2.0   \\
  $C_{\mathrm{turb}}$               & SDSC5           & SDS4  & 0.0 & 0.0 &  0.0   \\
  $\delta_d$                        & SDSC6           & SDS4  & 0.3 & 0.3 &  0.3   \\
  $C$                               & NLPROP          & SNL1  & $2.5\times 10^7$ & $\mathbf{2.7\times 10^7}$  & $2.5\times 10^7$   \\
 \hline \hline
\end{tabular} \end{center}
\caption{Same as table \ref{tab:ST4_parSIN}, for the SDS4 and SNL1 namelists. Bold values are different from the 
default values set by ww3\_grid.} \label{tab:ST4_parSDS}
\end{table}


Finally, the wave-turbulence interaction term of \cite{art:TB02} and \cite{art:AJ06}),
is given by

\begin{equation}
\cS_{\mathrm{ds}}^{\mathrm{TURB}}\left(k,\theta\right) = - 2
C_{\mathrm{turb}} \sigma \cos(\theta_u - \theta) k \frac{\rho_a
u_\star^2}{g \rho_w}  N\left(k,\theta\right) .
\end{equation}

\noindent
The coefficient $C_{\mathrm{turb}}$ is of order 1 and can be used to adjust for
ocean stratification and wave groupiness.


\noindent
All relevant source term parameters can be set via the namelists SIN4 and SDS4
to yield parameterizations TEST441b, TEST405, 
both described by \cite{art:Aea10}  or TEST500 described by \cite{art:FA12}. Please note that 
the DIA constant $C$ has been slightly adjusted in TEST441b, $C=2.5\times 10^7$. TEST441f corresponds 
to a re-tuned wind input formulation when using NCEP/NCAR winds. 

% -------------------------------------------------------------
\vsssub
\subsubsection{~Linear input (Cavaleri and Malanotte-Rizzoli)} \label{sec:c&mr}
\vsssub

A linear input source term is useful to allow for the consistent spin-up of a
model from quiescent conditions, and to improve initial wave growth
behavior. Available in \ws\ is the parameterization of \cite{art:CMR81}, with
a filter for low-frequency energy as introduced by \cite{tol:JPO92}. The input
term can be expressed as

\begin{equation}
\cS_{lin}(k,\theta) = 80 \left( \frac{\rho_a}{\rho_w} \right ) ^2
  g^{-2}  k^{-1} \max \left [ 0 , u_* \cos (\theta - \theta_w) \right ]^4 \: G
   \:\:\: , \label{eq:CMR81}
\end{equation}

\noindent
where $\rho_a$ and $\rho_w$ are the densities of air and water, respectively,
and where $G$ is the filter function

\begin{equation}
G = \exp \left [ - \left ( \frac{f}{f_{filt}} \right ) ^{-4} \right ]
\:\:\: . \label{eq:GSln}
\end{equation}

\noindent
In \cite {tol:JPO92} the filter frequency $f_{filt}$ was given as the
Pierson-Moskowitz frequency $f_{PM}$, which in turn was estimated as in
Eq.~(\ref{eq:f_PM}).  In the present implementation, the filter can be related
to both $f_{PM}$ and the cut-off frequency of the prognostic part of the
spectrum $f_{hf}$ as defined in Eq.~(\ref{eq:tail_E_f})

\begin{equation}
f_{filt} = \max \left [ \alpha_{PM} f_{PM} , \alpha_{hf} f_{hf} \right ]
\:\:\: ,
\end{equation}

\noindent
where the constants $\alpha_{PM}$ and $\alpha_{hf}$ are user-defined. Default
values of these constants are set to $\alpha_{PM} = 1$ and $\alpha_{hf} =
0.5$.  Addition of the dependency on $f_{hf}$ assures consistent growth
behavior at all fetches, without the possibility of low-frequency linear
growth to dominate at extremely short fetches.


% -------------------------------------------------------------
\vsssub
\subsubsection{~Bottom friction (\js)} \label{sec:jonswap}
\vsssub

A simple parameterization of bottom friction is the empirical, linear \js\
parameterization \citep{art:JONSWAP}, as used in the \wam\ model
\citep{art:WAM88}. Using the notation of \cite{tol:JPO91b}, this source term
can be written as

%-------------------------%
% JONSWAP bottom friction %
%-------------------------%
% eq:JONSWAP_bot

\begin{equation}
\cS_{bot}(k,\theta) = 2 \Gamma \: \frac{n-0.5}{gd} \: N(k,\theta)
\: , \label{eq:JONSWAP_bot}
\end{equation}

\noindent
where $\Gamma$ is an empirical constant, which is estimated as $\Gamma =
-0.038\:\mbox m^2 \mbox s ^{-3}$ for swell \citep{art:JONSWAP}, and as $\Gamma
= -0.067\:\mbox m^2 \mbox s^{-3}$ for wind seas \citep{art:BK83}. $n$ is the
ratio of phase velocity to group velocity given by (\ref{eq:cg}). The default
value for $\Gamma = -0.067$ can be redefined by the user in the model input
files.

\vsssub
\subsubsection{~Bottom friction (SHOWEX)} \label{sec:showex}
\vsssub

A more realistic parameterization for sandy bottoms is based on the eddy viscosity model 
by \cite{art:GM79} and a roughness parameterization that includes the formation of ripples 
and transition to sheet flow. The parameterization of \cite{tol:JPO94}, was adjusted by 
\cite{art:AHJR03} to field measurements from the DUCK'94 and SHOWEX experiments on the 
North Carolina continental shelf. The parameterization has been adapted to \ws by also 
including a sub-grid parameterization for the variability of the water depth, 
as given by  \cite{tol:CE95}. This parameterization is activated by the switch BT4. 

The source term can be written as

%-------------------------%
% JONSWAP bottom friction %
%-------------------------%
% eq:JONSWAP_bot

\begin{equation}
\cS_{bot}(k,\theta) = - f_e u_b \: \frac{\sigma^2}{2 g \sinh^2(kd)} \: N(k,\theta)
\: , \label{eq:SHOWEX_bot}
\end{equation}

\noindent
where $f_e$ is a dissipation factor that is a function of the r.m.s. bottom orbital 
displacement amplitude $a_b$ and the Nikuradse roughness length $k_N$, and 
$u_b$ is the r.m.s. amplitude of the bottom orbital 
velocity.

The present bed roughness parameterization (\ref{eq:SHOWEX_kr})--(\ref{eq:SHOWEX_krr}) contains seven empirical
coefficients listed in the table below. 

\begin{table} \begin{center}
\begin{tabular}{|l|c|c|c|c|c|} \hline \hline
Par.         &  WWATCH var.           & namelist &  SHOWEX  &  \cite{tol:JPO94} \\
\hline
  $A_1$ &  RIPFAC1                    & BT4 & 0.4     & 1.5    \\
  $A_2$ &  RIPFAC2                    & BT4 & -2.5    & -2.5   \\
  $A_3$ &  RIPFAC3                    & BT4 & 1.2     & 1.2     \\
  $A_4$ &  RIPFAC4                    & BT4 & 0.05    & 0.0     \\
  $\sigma_d$ &  SIGDEPTH              & BT4 & 0.05    & user-defined  \\
  $A_5$ &  BOTROUGHMIN                & BT4 & 0.01    & 0.0     \\
  $A_6$ &  BOTROUGHFAC                & BT4 & 0.03    & 0.0     \\
\hline
\end{tabular} \end{center}
\caption{Parameter values for the SHOWEX bottom friction and the original 
parameterization by \cite{tol:JPO94}. Source term
parameterizations that can be reset via the BT4 namelist. Please
note that the name of the variables only apply to the namelists. In the source
term module the seven variables are contained in the array SBTCX. } \label{tab:WAM4_parSIN}
\end{table}

The roughness $k_{N}$ is decomposed in a ripple roughness $k_{r}$ and a sheet flow roughness $k_{s}$,
\begin{eqnarray}
k_{r} &=&a_{b}\times A_{1}\left( \frac{\psi }{\psi _{c}}\right) ^{A_{2}}, \label{eq:SHOWEX_kr}\\
k_{s} &=&0.57\frac{u_{b}^{2.8}}{\left[ g\left( s-1\right) \right] ^{1.4}}%
\frac{a_{b}^{-0.4}}{\left( 2\pi \right) ^{2}}.
\end{eqnarray}
In (\ref{kr}) $A_1$ and $A_2$ are empirical constants,
$s$ is the sediment specific density, $\psi$ is the Shields number determined from
$u_b$ and the median sand grain diameter $D_{50}$,
\begin{equation}
\psi =f_{w}^{\prime }u_{b}^{2}/\left[g\left( s-1\right) D_{50}\right],
\end{equation}
with $f_{w}^{\prime }$ the friction factor of sand grains (determined in the same way as
$f_e$ with $D_{50}$ instead of $k_r$ as the bottom roughness),
and $\psi _{c}$ is the
critical Shields number for the initiation of
sediment motion under sinusoidal waves on a flat bed.
We use an analytical fit \citep{bk:Soul97} 
\begin{eqnarray}
\psi _{c} &=&\frac{0.3}{1+1.2D_{*}}+0.055\left[ 1-\exp \left(
-0.02D_{*}\right) \right]\label{Soulsby_psic} , \\
D_{*} &=&D_{50}\left[ \frac{g\left( s-1\right) }{\nu ^{2}}\right] ^{1/3},
\end{eqnarray}
where $\nu $ is the kinematic viscosity of water. 

When the wave motion is not strong enough to generate vortex ripples, i.e.
for values of the Shields number less than a threshold $\psi _{{\rm rr}}$,
$k_{N}$ is given by a relic ripple roughness $k_{{\rm rr}}$. The threshold is
\begin{equation}
\psi _{{\rm rr}}=A_{3}\psi _{c}.
\end{equation}
Below this threshold, $k_{N}$ is given by 
\begin{equation}
k_{{\rm rr}}=\max \left\{ A_5 {\rm m,} A_6 D_{50}, A_{4}a_{b}\right\}
{\rm for\ }\psi <\psi _{{\rm rr}}.\label{eq:SHOWEX_krr}
\end{equation}





% -------------------------------------------------------------
\vsssub
\subsubsection{~Surf breaking (Battjes-Janssen) \hfill {\rm (J. H. G. M. Alves)}} \label{sec:BJ}
\vsssub

The implementation in \ws\ of depth-induced breaking algorithms is intended to
extend the applicability of the model to within shallow water environments,
where wave breaking, among other depth-induced transformation processes,
becomes important.

The first step in that direction is the inclusion of the approach of
\citet[][henceforth denoted as BJ78]{pro:BJ78}, which is based on the
assumption that all waves in a random field exceeding a threshold height,
defined as a function of bottom topography parameters, will break. For a
random wave field, the fraction of waves satisfying this criterion is
determined by a statistical description of surf-zone wave heights (i.e., a
Rayleigh-type distribution, truncated at a depth-dependent wave-height
maximum).

The bulk rate $\delta$ of spectral energy density dissipation of the fraction
of breaking waves, as proposed by BJ78, is estimated using an analogy with
dissipation in turbulent bores as

%-------------------------------%
% Battjes Janssen surf breaking %
%-------------------------------%
% eq:BJ78_base

\begin{equation}
\delta = 0.25 \: Q_b \: f_m \: H_{\max}^2 \:\:\: , \label{eq:BJ78_base}
\end{equation}

\noindent
where $Q_b$ is the fraction of breaking waves in the random field, $f_m$ is
the mean frequency and $H_{\max}$ is the maximum individual height a component
in the random wave field can reach without breaking (conversely, above which
all waves would break). In BJ78 the maximum wave height $H_{\max}$ is defined
using a Miche-type criterion \citep{art:Miche44},

% eq:BJ78_Miche

\begin{equation}
\bar{k} H_{\max} = \gamma_M \tanh ( \bar{k} d )
\:\:\:\ , \label{eq:BJ78_Miche}
\end{equation}

\noindent
where $\gamma_M$ is a constant factor. This approach also removes energy in
deep-water waves exceeding a limiting steepness. This can potentially result
in double counting of dissipation in deep-water waves. Alternatively,
$H_{\max}$ can be defined using a McCowan-type criterion, which consists of
simple constant ratio

% eq:BJ78_McC

\begin{equation}
H_{\max} = \gamma \: d \:\:\:\ , \label{eq:BJ78_McC}
\end{equation}

\noindent
where $d$ is the local water depth and $\gamma$ is a constant derived from
field and laboratory observation of breaking waves. This approach will
exclusively represent depth-induced breaking.  Although more general breaking
criteria for $H_{\max}$ as a simple function of local depth exist
\citep[e.g.,][]{art:TG83}, it should be noted that the coefficient $\gamma$
refers to the maximum height of an individual breaking wave within the random
field. \cite{art:M1894} calculated the limiting wave-height-to-depth ratio for
a solitary wave propagating on a flat bottom to be 0.78, which is still used
presently as a conservative criteria in engineering applications. The average
value found by \cite{pro:BJ78} was $\gamma = 0.73$. More recent analyses of
waves propagating over reefs by \cite{art:Nel94, art:Nel97} suggest a ratio of
0.55.

The fraction of breaking waves $Q_b$ is determined in terms of a Rayleigh-type
distribution truncated at $H_{\max}$ (i.e., all broken waves have a height
equal to $H_{max}$), which results in the following expression:

% eq:BJ78_Qb

\begin{equation}
\frac{1 - Q_b}{-\ln Q_b} = \left ( \frac{H_{rms}}{H_{\max}} \right )
\:\:\: , \label{eq:BJ78_Qb}
\end{equation}

\noindent
where $H_{rms}$ is the root-mean-square wave height. In the current
implementation, the implicit equation (\ref{eq:BJ78_Qb}) is solved for $Q_b$
iteratively. With the assumption that the total spectral energy dissipation
$\delta$ is distributed over the entire spectrum so that it does not change
the spectral shape \citep{art:EB96} the following depth-induced breaking
dissipation source function is obtained

% eq:BJ78

\begin{equation}
\cS_{db} (k,\theta) = - \alpha \frac{\delta}{E} F(k,\theta)
       = - 0.25 \: \alpha \: Q_b \: f_m \frac{H_{\max}^2}{E} F(k,\theta)
\:\:\: , \label{eq:BJ78}
\end{equation}

\noindent
where $E$ is the total spectral energy, and $\alpha = 1.0$ is a tunable
parameter. The user can select between Eqs.~(\ref{eq:BJ78_Miche}) and
(\ref{eq:BJ78_McC}), and adjust $\gamma$ and $\alpha$. Defaults are
Eq.~(\ref{eq:BJ78_McC}), $\gamma = 0.73$ and $\alpha = 1.0$.


% -------------------------------------------------------------
\vsssub
\subsubsection{~Triad interactions} \label{sec:triad}
\vsssub

Not yet available.


% -------------------------------------------------------------
\vsssub
\subsubsection{~Bottom scattering \hfill {\rm (R. Magne and F. Ardhuin)}}
\label{sec:bscat}
\vsssub

Waves propagating over a sloping bottom are partially reflected.  In the limit
of small variation in water depth $\Delta H$ with respect to the mean water
depth $H$, the reflection coefficient is proportional to the bottom spectrum
\cite{art:Kre49} and leads to a redistribution of wave energy in direction.
This process may be formulated as a source term, which leads to accurate
reflection coefficients when considering the evolution of the spectrum over
scales larger than the bottom auto-correlation length, with reasonable
accuracy up to $\Delta d / d \simeq 0.6$ \citep{art:AM07}. The source term
reads,

\begin{equation}
\cS_{\mathrm{sc}}({\bk}) =
\frac{\pi}{2}\int_{0}^{2 \pi}
 \frac{k'^2 M^2({\bk},\textbf{k}')}{\sigma \sigma' \left(k' C'_g +
{\bk}  \cdot {\bf U}  \right)}
 F^B({\bk}-\textbf{k}')
\left[N(\textbf{k}')- N(\textbf{k})\right] {\mathrm d}
\theta',\label{Sbscat}
\end{equation}

\noindent
with the coupling coefficient

\begin{equation}
M({\bk},{\bk}^\prime)\simeq M_b({\bk},{\bk}^\prime) =\frac{g {\bk}
\cdot {\bk}^\prime}{\cosh(kd)\cosh(k'd)}
\end{equation}

\noindent
 where the effect of bottom-induced current and elevation changes are
neglected, as appropriate for low to moderate current velocity relative to the
intrinsic phase speed, i.e. $U/C < 0.3$. For larger Froude numbers, in
particular in near-blocking conditions, the present implementation is not
expected to be accurate.  In Eq.~(\ref{Sbscat}), $k$ and $k'$ are related by
the resonance condition, $\omega=\omega'$, i.e. $\sigma+{\bk} \cdot {\bf U}
=\sigma' + {\bk}^\prime \cdot {\bf U}$, where ${\bf U}$ is the phase advection
velocity \cite[see, e.g.,][]{art:WISE07}.

The bottom spectrum $F^B({\bk})$ is specified in the file {\file
bottomspectrum.inp}. This spectrum may be determined from multi beam
bathymetric data.  In the absence of detailed bathymetric data, the sand dune
spectrum may be parameterized based on the work of \cite{art:Hino68}.  Recent
observations generally confirm the earlier data on sand dune spectra
\citep{art:AM07}, with a non-dimensional constant spectrum for large $k$,
i.e. $F^B({\bk}) \sim k^{-4}$.

The bottom spectrum is double-sided for simplicity of calculation
and normalized such that the bottom variance (in square meters) is

\begin{equation}
<d^2> =\int_{-\infty}^{\infty} \int_{-\infty}^{\infty}
F^B(k_x,k_y)  {\mathrm d} k_x  {\mathrm d} k_y.
\end{equation}

\noindent
In the present implementation this bottom spectrum is assumed to be the same
at all grid points.

The source term is computed according to different methods depending on the
value of the current. For zero current, the interactions only involves waves
of the same frequency and the interaction is always the same and linear in
terms of the directional spectrum. In this case the interaction is expressed
as a matrix problem, and the interaction matrices are diagonalized as a
preprocessing step for a finite number of wavenumber magnitudes
\citep{art:AH02}.  The cost of this preprocessing increases linearly with the
number of discrete wavenumbers.

For non-zero current, the interaction pattern depends on the current magnitude
and direction (magnitude only for an isotropic bottom spectrum), and this
would increase the overhead cost by at least one order of magnitude. In the
present implementation, the interaction integration is recomputed at every
source term call.

% -------------------------------------------------------------
\vsssub
\subsubsection{~Reflection by shoreline and icebergs  \hfill {\rm (F. Ardhuin)}} 
\label{sec:ref}
\vsssub
Reflections by shorelines and icebergs is activated by setting namelists parameters REFCOAST, REFSUBGRID or REFBERG 
(in namelist REF1) to non-zero values that are the target reflection coefficients $R_0^2$ for the wave energy. 
From these values $R_0^2$ may be varied with wave height and period following a Miche-type parameter: this is 
activated by setting REFFREQ to a non-zero value, and is  based on the field 
measurements of \cite{art:EHG94}. 
These coefficients can also be made to vary spatially, by 
setting REFMAP to a non-zero value. In that case ww3\_grid will expect to find a extra line after the reading 
of the water depths and obstructions in ww3\_grid.inp. 

Wave reflection at the shoreline varies from a fraction of a percent to about 40\% of the incoming 
wave energy, and may have important consequences for the directional wave spectrum, 
and the wave climate in otherwise sheltered locations \citep{pro:ORe99}. Wave reflection is 
also extremely important for the generation of seismic noise by ocean waves.

Because reflection involve wave trains with different directions, in a model like WWATCH, their interaction can only be 
represented through a source term in the right hand side. Nevertheless, this is physically linked to propagation. 

In practice, for the regular grids, the reflection source term puts into the reflected wave directions the proper amount of energy that will be taken away by propagation 
at the next time step. When neglecting the cross-shore current, this is 

\begin{equation} 
\cS_{ref}(k,\theta) = 
\int R^2(k,\theta,\theta') \frac{C_g(k)}{\Delta A} \left[\cos \theta \Delta y + \sin \theta  \Delta x \right] N(k,\theta') \mathrm{d} \theta'
\end{equation}
where $R^2$ is  an energy reflection coefficient, and $\Delta x$ and $\Delta y$ are the grid spacing along the two axes, and
$\Delta A$ is the cell area. The definition of the shoreline direction from the land/sea mask is explained in \cite{art:Aea11}. It has not 
been adapted for curvilinear grids. 

In the case of unstructured grids, the spectral density of outgoing directions on the boundary 
is directly set to the expected reflected value and the boundary condition is handled specifically by the the numerical schemes. 

The reflection coefficient $R^2$ is taken to be non-zero only for the directions for which  $\cos(\theta-\theta')<0$, and its magnitude 
is the product of a reflection coefficient $R_0^2(k)$, integrated over the scattered directions $\theta$, 
and a directional distribution  $R_2(\theta,\theta')$ around the specular direction $\theta_s$,  
\begin{equation} 
R^2(k,\theta,\theta')  =  R_0^2(k) R_2(\theta,\theta').
\end{equation}

This directional distribution takes three forms: 
\begin{itemize}
 \item isotropic in all directions opposite to the incoming direction: this is for sub-grid islands and icebergs or sharp shoreline angles
 \item proportional to $\cos(\theta-\theta_s)^2$ for moderate shoreline angles
 \item proportional to $\cos(\theta-\theta_s)^n$ for small shoreline angles (nearly straight shoreline). Where $n=4$ by default and can be changed 
to any value using the REFCOSP\_STRAIGHT namelist parameter in the REF1 namelist.
\end{itemize}
That parameterization is described in detail by \cite{art:AR12}. 

% -------------------------------------------------------------
\vsssub
\subsubsection{~User-defined source terms} \label{sec:sxx}
\vsssub

This slot is intended for a source term that is not yet classified in
Eq.~(\ref{eq:general_st}). Almost by definition, it cannot be provided here.


% -------------------------------------------------------------
\vssub
\subsection{~Output parameters} \label{sub:outpars}
\vssub

The wave model provides output of the following gridded fields of mean wave
parameters. Some of these parameters can also be found in the output for
selected points. For activation of the output see \para\ref{sec:shell}

Since version 4.TBD, WAVEWATCH III output fields are defined by a double-indexing 
structure, where the first index refers to a functional group that parameters belong
to, and the second number is the index for a given parameter within its group. Groups
are defined according to Table \ref{tab:noge}.

\begin{table} \begin{center}
 \begin{tabular}{|l|c|} \hline \hline
Group Name & Elements \\ \hline
Forcing Fields & 6 \\
Mean Wave Parameters & 9 \\ 
Spectrum Parameters & N/A \\
Partitions Parameters & 8 \\
Atmosphere-Waves Layer & 10 \\
Wave-Ocean Layer & 7 \\
Wave-Bottom Layer & 5 \\
Spectrum parameters & 2 \\
Numerical Diagnostics & 5 \\
User Defined & 2 \\ \hline
\end{tabular} \end{center}
\caption{Groups in new double-indexing output field structure.}
\label{tab:noge} \botline \end{table}

\subsubsection{Forcing Fields}

\begin{list}{\arabic{outpars})\hfill}
            {\usecounter{outpars} \leftmargin 15mm \labelwidth 7mm
             \rightmargin 5mm \itemsep 0mm \parsep 0mm}
\item The mean water depth (m).
\item The mean current velocity (vector, m/s).
\item The mean wind speed (vector, m/s). This wind speed is alway the
      speed as input to the model, i.e., is not corrected for the current
      speed.
\item The air-sea temperature difference ($^\circ$C).
\item Water level.
\item Ice concentration.
\item Wave attenuation due to icebergs: this parameter is the inverse of the e-folding scale 
associated to the loss of wave energy in a field of small icebergs \citep{Aeb11}. 
\item Sediment median grain size ($D_{50}$). 
\end{list}

\subsubsection{Standard mean wave parameters}

\begin{list}{\arabic{outpars})\hfill}
            {\usecounter{outpars} \leftmargin 15mm \labelwidth 7mm
             \rightmargin 5mm \itemsep 0mm \parsep 0mm}
\item Significant wave height (m) [see Eq.~(\ref{eq:etot})]
      \begin{equation} H_s = 4 \sqrt{E} \: . \label{eq:Hs} \end{equation}
\item Mean wave length (m) [see Eq.~(\ref{eq:zbar})]
      \begin{equation} L_m = 2\pi \overline{k^{-1}}
      \: . \label{eq:Lm} \end{equation}
\item Mean wave period (s) [see Eq.~(\ref{eq:zbar})]
      \begin{equation} T_{m02} = 2\pi /\sqrt{\overline{\sigma^{2}}}
      \: . \label{eq:Tm02} \end{equation}
\item Mean wave period (s) [see Eq.~(\ref{eq:zbar})]
      \begin{equation} T_{m0,-1} = 2\pi \overline{\sigma^{-1}}
      \: . \label{eq:Tm0m1} \end{equation}
\item Mean wave period (s) [see Eq.~(\ref{eq:zbar})]
      \begin{equation} T_{m0,-1} = 2\pi \overline{\sigma^{-1}}
      \: . \label{eq:Tm} \end{equation}
\item Peak frequency (Hz), calculated from the one-dimensional frequency
      spectrum using a parabolic fit around the discrete peak.
\item Mean wave direction (degr., meteorological convention)
      \begin{equation} \theta_m = \mbox{atan} \left ( \frac{b}{a} \right )
      \: , \label{eq:theta_m} \end{equation} \begin{equation}
      a = \int_0^{2\pi} \int_0^\infty \cos(\theta) F(\sigma,\theta) \:
      d\sigma \: d\theta \: , \end{equation} \begin{equation}
      b = \int_0^{2\pi} \int_0^\infty \sin(\theta) F(\sigma,\theta) \:
      d\sigma \: d\theta \: . \end{equation}
\item Mean directional spread \citep[degr.;][]{art:KVH88}
      \begin{equation} \sigma_\theta = \left [ 2 \left \{ 1 - \left (
      \frac{a^2+b^2}{E^2} \right )^{1/2} \right \} \right ]^{1/2}
      \: , \label{eq:sig_th} \end{equation}
\item Peak direction (degr.), defined like the mean direction, using the
      frequency/wavenumber bin containing of the spectrum $F(k)$ that
      contains the peak frequency only.
\end{list}
\subsubsection{Spectral parameters (first 5 moments and wavenumbers)}
\begin{list}{\arabic{outpars})\hfill}
            {\usecounter{outpars} \leftmargin 15mm \labelwidth 7mm
             \rightmargin 5mm \itemsep 0mm \parsep 0mm}
   
\item Wave frequency spectrum (m$^2$/Hz)
      \begin{equation} E(f) = 2 \pi  \int F(\sigma,\theta) \mathrm{d} \theta 
      \: . \label{eq:Ef} \end{equation}
\item Mean direction for each frequency  \citep[degr.;][]{art:KVH88}
       \begin{equation} \theta_1 (f)= \mbox{atan} \left ( \frac{b_1(f)}{a_1(f)} \right )
      \: , \label{eq:theta_m} \end{equation} \begin{equation}
      a_1(f) = 2 \pi \int_0^{2\pi} \int_0^\infty \cos(\theta) F(\sigma,\theta) \:
       \mathrm{d}\theta \: , \end{equation} \begin{equation}
      b_1(f) = 2 \pi \int_0^{2\pi} \int_0^\infty \sin(\theta) F(\sigma,\theta) \:
       \mathrm{d}\theta \: . \end{equation}
\item First directional spread for each frequency  (degr.; )
      \begin{equation} \sigma_1(f) = \left [ 2 \left \{ 1 - \left (
      \frac{a_1(f)^2+b_1(f)^2}{E(f)^2} \right )^{1/2} \right \} \right ]^{1/2}
      \: , \label{eq:sig_th1} \end{equation}
\item Mean direction from $a_2$ and $b_2$ (degr.) (NOT PLUGGED YET)
\item Spread from $a_2$ and $b_2$ (degr.)  (NOT PLUGGED YET)
\item Wavenumbers $k(\sigma)$ (rad/m)
      \begin{equation} \sigma^2 = g k \tanh (k D) 
      \: , \label{eq:k} \end{equation}
\end{list}
\subsubsection{Spectral partition parameters}
\begin{list}{\arabic{outpars})\hfill}
            {\usecounter{outpars} \leftmargin 15mm \labelwidth 7mm
             \rightmargin 5mm \itemsep 0mm \parsep 0mm}


\item Wave heights $H_s$ of partitions of the spectrum (see
      below). \label{out:first_part}
\item Peak (relative) periods of partitions of the spectrum (parabolic fit).
\item Peak wave lengths of partitions of the spectrum (from peak period).
\item Mean direction of partitions of the spectrum.
\item Directional spread of partition of the spectrum
      Cf. Eq.~(\ref{eq:sig_th}).
\item Wind sea fraction of partition of the spectrum (see below).
\item Wind sea fraction of the entire spectrum.
\item Number of partitions found in the spectrum. \label{out:last_part}
\end{list}

\subsubsection{Atmosphere-waves layer}
\begin{list}{\arabic{outpars})\hfill}
            {\usecounter{outpars} \leftmargin 15mm \labelwidth 7mm
             \rightmargin 5mm \itemsep 0mm \parsep 0mm}
\item The friction velocity $u_\ast$ (scalar). Definition depends on
      selected source term parameterization (m/s). An alternative vector version
      of the stresses is available for research (requires user intervention in
      the code).
\item Charnock parameter for air-sea friction (without dimensions)
\item Energy flux (W/m)
      \begin{equation} C_g E =  \rho_w g \overline{C_g} E
      \: . \label{eq:CgE} \end{equation}
\item Wind to wave energy flux
\item Net wave-supported stress (wind to wave momentum flux) 
\item Wave to wind momentum flux
\item Whitecap coverage (without dimensions) 
\item Whitecap mean thickness (m) (NOT PLUGGED YET)
\item Mean breaking wave height (m) (NOT PLUGGED YET)
\item Moment of whitecap distribution (?) (NOT PLUGGED YET)
\end{list}

\subsubsection{Wave-ocean layer}
\begin{list}{\arabic{outpars})\hfill}
            {\usecounter{outpars} \leftmargin 15mm \labelwidth 7mm
             \rightmargin 5mm \itemsep 0mm \parsep 0mm}
\item Radiation stresses
      \begin{equation} S_{xx} = \rho_w g \int \!\!\!\! \int \left
        ( n - 0.5 + n \cos^2 \theta \right )  \: F(k,\theta) \: dk d\theta
      \: , \label{eq:Sxx} \end{equation}
      \begin{equation} S_{xy} =\rho_w g \int \!\!\!\! \int
        n \sin \theta \cos \theta  \: F(k,\theta) \: dk d\theta
      \: , \label{eq:Syy} \end{equation}
      \begin{equation} S_{yy} =\rho_w g \int \!\!\!\! \int \left
        ( n - 0.5 + n \sin^2 \theta \right )  \: F(k,\theta) \: dk d\theta
      \: , \label{eq:Sxy} \end{equation}
      where
      \begin{equation} n = \frac{1}{2} + \frac{kd}{\sinh 2kd}
      \: . \label{eq:n} \end{equation}
\item Wave to ocean energy flux
\item Bernoulli head
\item Wave to ocean momentum flux
\item Stokes volume transport (m$^2$/s)
\item Stokes drift at the sea surface (m/s)
\item Frequency spectrum of Stokes drift at the sea surface (m/s/Hz)
\item Second order pressure variance (m$^2$) and peak period of this pressure (s) which contributes to acoustic and seismic noise, 
      \begin{equation} F_{p2D} = \int_0^{\infty} \frac{4 \sigma}{C_g} \int_0^{\pi}  F(k,\theta) \:  F(k,\theta+\pi) \:  d\theta dk
      \: , \label{eq:Sxx} \end{equation}
      \begin{equation} S_{xy} =\rho_w g \int \!\!\!\! \int
        n \sin \theta \cos \theta  \: F(k,\theta) \: dk d\theta
      \: , \label{eq:Syy} \end{equation}
\end{list}

\subsubsection{Wave-bottom layer}
\begin{list}{\arabic{outpars})\hfill}
            {\usecounter{outpars} \leftmargin 15mm \labelwidth 7mm
             \rightmargin 5mm \itemsep 0mm \parsep 0mm}

\item Near-bottom rms excursion amplitude
      \begin{equation} a_{b,rms} = \left [ 2 \int \!\!\!\! \int
      \frac{1}{\sinh^2 kd} \: F(k,\theta) \: dk d\theta \right ] ^{1/2}
      \: . \label{eq:ab_rms} \end{equation}
\item Near-bottom rms orbital velocity
      \begin{equation} u_{b,rms} = \left [ 2 \int \!\!\!\! \int
      \frac{\sigma^2}{\sinh^2 kd} \: F(k,\theta) \: dk d\theta \right ] ^{1/2}
      \: . \label{eq:ub_rms} \end{equation}
\item Bedform parameters  
\item Energy dissipation in WBBL 
\item Momentum loss in WBBL 
\end{list}

\subsubsection{Remote sensing and spectral tail}
\begin{list}{\arabic{outpars})\hfill}
            {\usecounter{outpars} \leftmargin 15mm \labelwidth 7mm
             \rightmargin 5mm \itemsep 0mm \parsep 0mm}

\item Mean square slopes in $x$ and $y$ directions (zonal and meridional components of slopes variances). 
\item Spectral tail level (without dimensions) 
\end{list}

\subsubsection{Numerical diagnostics }
\begin{list}{\arabic{outpars})\hfill}
            {\usecounter{outpars} \leftmargin 15mm \labelwidth 7mm
             \rightmargin 5mm \itemsep 0mm \parsep 0mm}
\item Average time step in the source term integration (s).
\item Cut-off frequency $f_c$ (Hz, depends on parameterization of
      input and dissipation).
\item Maximum CFL number for spatial advection 
\item Maximum CFL number for angular advection 
\item Maximum CFL number for wavenumber advection 
\end{list}

\subsubsection{User defined }
\begin{list}{\arabic{outpars})\hfill}
            {\usecounter{outpars} \leftmargin 15mm \labelwidth 7mm
             \rightmargin 5mm \itemsep 0mm \parsep 0mm}

\item Slot for user defined parameter (requires modification of code).
\item Idem.
\end{list}

\noindent
Output types \ref{out:first_part} through \ref{out:last_part} are based on
partitioning of the spectrum into individual wave fields. The method of
\cite{art:HP01} is used, implemented as described in \cite{tol:Oahu07a}. With
this, a `wind sea fraction' $W$ is introduced

\begin{equation}
W = E^{-1}  \: E |_{U_p > c}  \:\:\: , \label{eq:wsf}
\end{equation}

\noindent
where $E$ is the total spectral energy, and $E |_{U_p > c}$ is the energy in
the spectrum for which the projected wind speed $U_p$ is larger than the local
wave phase velocity $c = \sigma / k$. The latter defines an area in the
spectrum under the direct influence of the wind. To allow for nonlinear
interactions to shift this boundary to lower frequencies, and subsequently to
have fully grown wind seas inside this are, $U_p$ includes a multiplier
$C_{mult}$

\begin{equation}
U_p = C_{mult} U_{10} \cos ( \theta - \theta_w )  \:\:\: . \label{eq:Up}
\end{equation}

\noindent
The multiplier can be set by the user. The default value is $C_{mult} = 1.7$.

THESE TWO PARAMETERS WILL BE PUT BACK. 
Old output types \ref{out:old_fpw} and \ref{out:old_thw} have become obsolete
with the introduction of the partitioned output types \ref{out:first_part}
through \ref{out:last_part}. However, they are retained in the present model
release to provide required downward compatibility with model version 1.18 at
NCEP. These output types are likely to be retired in upcoming versions of \ws.

%\bpage
